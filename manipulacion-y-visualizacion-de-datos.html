<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Estadística Aplicada III</title>
  <meta name="description" content="Notas y material para el curso de Estadística Aplicada III, 2018 (ITAM)">
  <meta name="generator" content="bookdown 0.7.1 and GitBook 2.6.7">

  <meta property="og:title" content="Estadística Aplicada III" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas y material para el curso de Estadística Aplicada III, 2018 (ITAM)" />
  <meta name="github-repo" content="andreuboada/est-aplicada-3-2018" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Estadística Aplicada III" />
  
  <meta name="twitter:description" content="Notas y material para el curso de Estadística Aplicada III, 2018 (ITAM)" />
  

<meta name="author" content="Andreu Boada de Atela">


<meta name="date" content="2018-03-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="Rintro.html">
<link rel="next" href="teorema-del-limite-central.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="toc.css" type="text/css" />
<link rel="stylesheet" href="font-awesome.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Estadística Aplicada III</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Temario y referencias</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#evaluacion"><i class="fa fa-check"></i>Evaluación</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-r-y-rstudio"><i class="fa fa-check"></i>Software: R y Rstudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#referencias-principales"><i class="fa fa-check"></i>Referencias principales</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#otras-referencias"><i class="fa fa-check"></i>Otras referencias</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#tareas"><i class="fa fa-check"></i>Tareas</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introducción</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#por-que-un-analisis-multivariado"><i class="fa fa-check"></i><b>1.1</b> ¿Por qué un análisis multivariado?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#la-paradoja-de-simpson"><i class="fa fa-check"></i><b>1.2</b> La paradoja de Simpson</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#modelos-log-lineales"><i class="fa fa-check"></i><b>1.3</b> Modelos log-lineales</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#interpretacion-de-parametros"><i class="fa fa-check"></i><b>1.4</b> Interpretación de parámetros</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#ejemplo-dos-monedas"><i class="fa fa-check"></i><b>1.4.1</b> Ejemplo: dos monedas</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#otros-ejemplos"><i class="fa fa-check"></i><b>1.5</b> Otros ejemplos</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#discriminacion-de-residentes-hispanos-con-discapacidades"><i class="fa fa-check"></i><b>1.5.1</b> Discriminación de residentes hispanos con discapacidades</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#consumo-de-chocolate-y-premios-nobel"><i class="fa fa-check"></i><b>1.5.2</b> Consumo de chocolate y premios Nobel</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#tarea"><i class="fa fa-check"></i><b>1.6</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Rintro.html"><a href="Rintro.html"><i class="fa fa-check"></i><b>2</b> Temas selectos de R</a><ul>
<li class="chapter" data-level="2.1" data-path="Rintro.html"><a href="Rintro.html#que-ventajas-tiene-r"><i class="fa fa-check"></i><b>2.1</b> ¿Qué ventajas tiene R?</a><ul>
<li class="chapter" data-level="2.1.1" data-path="Rintro.html"><a href="Rintro.html#r-es-gratuito-y-de-codigo-abierto"><i class="fa fa-check"></i><b>2.1.1</b> R es gratuito y de código abierto</a></li>
<li class="chapter" data-level="2.1.2" data-path="Rintro.html"><a href="Rintro.html#r-tiene-una-comunidad-comprometida"><i class="fa fa-check"></i><b>2.1.2</b> R tiene una comunidad comprometida</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="Rintro.html"><a href="Rintro.html#flujo-basico-de-trabajo-para-el-analisis-de-datos-en-r."><i class="fa fa-check"></i><b>2.2</b> Flujo básico de trabajo para el análisis de datos en R.</a></li>
<li class="chapter" data-level="2.3" data-path="Rintro.html"><a href="Rintro.html#introduccion-a-r-como-lenguaje-de-programacion-y-la-plataforma-interactiva-de-rstudio."><i class="fa fa-check"></i><b>2.3</b> Introducción a R como lenguaje de programación, y la plataforma interactiva de RStudio.</a><ul>
<li class="chapter" data-level="2.3.1" data-path="Rintro.html"><a href="Rintro.html#como-entender-r"><i class="fa fa-check"></i><b>2.3.1</b> ¿Cómo entender R?</a></li>
<li class="chapter" data-level="2.3.2" data-path="Rintro.html"><a href="Rintro.html#por-que-r"><i class="fa fa-check"></i><b>2.3.2</b> ¿Por qué R?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="Rintro.html"><a href="Rintro.html#estructuras-de-datos"><i class="fa fa-check"></i><b>2.4</b> Estructuras de datos</a><ul>
<li class="chapter" data-level="2.4.1" data-path="Rintro.html"><a href="Rintro.html#vectores"><i class="fa fa-check"></i><b>2.4.1</b> Vectores</a></li>
<li class="chapter" data-level="2.4.2" data-path="Rintro.html"><a href="Rintro.html#data-frames"><i class="fa fa-check"></i><b>2.4.2</b> Data Frames</a></li>
<li class="chapter" data-level="2.4.3" data-path="Rintro.html"><a href="Rintro.html#listas"><i class="fa fa-check"></i><b>2.4.3</b> Listas</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="Rintro.html"><a href="Rintro.html#r-markdown"><i class="fa fa-check"></i><b>2.5</b> R Markdown</a><ul>
<li class="chapter" data-level="2.5.1" data-path="Rintro.html"><a href="Rintro.html#que-es-r-markdown"><i class="fa fa-check"></i><b>2.5.1</b> ¿Qué es R Markdown?</a></li>
<li class="chapter" data-level="2.5.2" data-path="Rintro.html"><a href="Rintro.html#estructura-basica-de-r-markdown"><i class="fa fa-check"></i><b>2.5.2</b> Estructura básica de R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="Rintro.html"><a href="Rintro.html#proyectos-de-rstudio"><i class="fa fa-check"></i><b>2.6</b> Proyectos de RStudio</a></li>
<li class="chapter" data-level="2.7" data-path="Rintro.html"><a href="Rintro.html#otros-aspectos-importantes-de-r"><i class="fa fa-check"></i><b>2.7</b> Otros aspectos importantes de R</a><ul>
<li class="chapter" data-level="2.7.1" data-path="Rintro.html"><a href="Rintro.html#valores-faltantes"><i class="fa fa-check"></i><b>2.7.1</b> Valores faltantes</a></li>
<li class="chapter" data-level="2.7.2" data-path="Rintro.html"><a href="Rintro.html#funciones"><i class="fa fa-check"></i><b>2.7.2</b> Funciones</a></li>
<li class="chapter" data-level="2.7.3" data-path="Rintro.html"><a href="Rintro.html#funcionales"><i class="fa fa-check"></i><b>2.7.3</b> Funcionales</a></li>
<li class="chapter" data-level="2.7.4" data-path="Rintro.html"><a href="Rintro.html#rendimiento-en-r"><i class="fa fa-check"></i><b>2.7.4</b> Rendimiento en R</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="Rintro.html"><a href="Rintro.html#tarea-1"><i class="fa fa-check"></i><b>2.8</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html"><i class="fa fa-check"></i><b>3</b> Manipulación y visualización de datos</a><ul>
<li class="chapter" data-level="3.1" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#el-principio-de-datos-limpios"><i class="fa fa-check"></i><b>3.1</b> El principio de datos limpios</a><ul>
<li class="chapter" data-level="" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#ejemplo"><i class="fa fa-check"></i>Ejemplo:</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#limpieza-de-datos"><i class="fa fa-check"></i><b>3.2</b> Limpieza de datos</a></li>
<li class="chapter" data-level="3.3" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#separa-aplica-combina"><i class="fa fa-check"></i><b>3.3</b> <em>Separa-aplica-combina</em></a></li>
<li class="chapter" data-level="3.4" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#muertes-por-armas-de-fuego-en-eua"><i class="fa fa-check"></i><b>3.4</b> Muertes por armas de fuego en EUA</a></li>
<li class="chapter" data-level="3.5" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#el-cuarteto-de-anscombe"><i class="fa fa-check"></i><b>3.5</b> El Cuarteto de Anscombe</a></li>
<li class="chapter" data-level="3.6" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#the-grammar-of-graphics-de-leland-wilkinson"><i class="fa fa-check"></i><b>3.6</b> The <em>Grammar of Graphics</em> de Leland Wilkinson</a></li>
<li class="chapter" data-level="3.7" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#ggplot"><i class="fa fa-check"></i><b>3.7</b> ggplot</a></li>
<li class="chapter" data-level="3.8" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#un-histograma-de-las-muertes-en-iraq"><i class="fa fa-check"></i><b>3.8</b> Un histograma de las muertes en Iraq</a></li>
<li class="chapter" data-level="3.9" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#inglehartwelzel-un-mapa-cultural-del-mundo"><i class="fa fa-check"></i><b>3.9</b> Inglehart–Welzel: un mapa cultural del mundo</a><ul>
<li class="chapter" data-level="3.9.1" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#creando-un-ggplot"><i class="fa fa-check"></i><b>3.9.1</b> Creando un ggplot</a></li>
<li class="chapter" data-level="3.9.2" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#mapeos-aesthetics"><i class="fa fa-check"></i><b>3.9.2</b> Mapeos: Aesthetics</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#poniendo-todo-junto"><i class="fa fa-check"></i><b>3.10</b> Poniendo todo junto</a></li>
<li class="chapter" data-level="3.11" data-path="manipulacion-y-visualizacion-de-datos.html"><a href="manipulacion-y-visualizacion-de-datos.html#tarea-2"><i class="fa fa-check"></i><b>3.11</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html"><i class="fa fa-check"></i><b>4</b> Teorema del Límite Central</a><ul>
<li class="chapter" data-level="4.1" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#la-distribucion-de-la-media"><i class="fa fa-check"></i><b>4.1</b> La distribución de la media</a></li>
<li class="chapter" data-level="4.2" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#de-donde-proviene-la-distribucion-normal"><i class="fa fa-check"></i><b>4.2</b> ¿De dónde proviene la distribución normal?</a><ul>
<li class="chapter" data-level="4.2.1" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#que-signo-tiene-c"><i class="fa fa-check"></i><b>4.2.1</b> ¿Qué signo tiene c?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#otras-observaciones"><i class="fa fa-check"></i><b>4.3</b> Otras observaciones</a></li>
<li class="chapter" data-level="4.4" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#diagramas-de-caja-y-brazos"><i class="fa fa-check"></i><b>4.4</b> Diagramas de caja y brazos</a><ul>
<li class="chapter" data-level="" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#ejemplo-1"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#graficas-de-cuantiles-teoricos"><i class="fa fa-check"></i><b>4.5</b> Gráficas de cuantiles teóricos</a><ul>
<li class="chapter" data-level="" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#ejemplo-normal"><i class="fa fa-check"></i>Ejemplo: normal</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#graficas-de-cuantiles-para-un-conjunto-de-datos"><i class="fa fa-check"></i><b>4.6</b> Gráficas de cuantiles para un conjunto de datos</a><ul>
<li class="chapter" data-level="4.6.1" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#que-buscar-en-una-grafica-de-cuantiles"><i class="fa fa-check"></i><b>4.6.1</b> ¿Qué buscar en una gráfica de cuantiles?</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#graficas-qq-normales"><i class="fa fa-check"></i><b>4.7</b> Gráficas qq-normales</a><ul>
<li class="chapter" data-level="" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#ejemplo-cantantes"><i class="fa fa-check"></i>Ejemplo: cantantes</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#el-tlc-y-errores-estandar"><i class="fa fa-check"></i><b>4.8</b> El TLC y errores estándar</a></li>
<li class="chapter" data-level="4.9" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#ejemplo-2"><i class="fa fa-check"></i><b>4.9</b> Ejemplo</a></li>
<li class="chapter" data-level="4.10" data-path="teorema-del-limite-central.html"><a href="teorema-del-limite-central.html#tarea-3"><i class="fa fa-check"></i><b>4.10</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html"><i class="fa fa-check"></i><b>5</b> Análisis de datos categóricos</a><ul>
<li class="chapter" data-level="5.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#repaso-y-algunos-conceptos"><i class="fa fa-check"></i><b>5.1</b> Repaso y algunos conceptos</a><ul>
<li class="chapter" data-level="5.1.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#caso-binomial"><i class="fa fa-check"></i><b>5.1.1</b> Caso binomial</a></li>
<li class="chapter" data-level="" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#estimacion-de-parametros-multinomiales"><i class="fa fa-check"></i>Estimación de parámetros multinomiales</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#la-chi2-de-pearson-de-una-multinomial"><i class="fa fa-check"></i><b>5.2</b> La <span class="math inline">\(\chi^2\)</span> de Pearson de una multinomial</a><ul>
<li class="chapter" data-level="5.2.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#cociente-de-verosimilitud-de-una-multinomial"><i class="fa fa-check"></i><b>5.2.1</b> Cociente de verosimilitud de una multinomial</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#definiciones"><i class="fa fa-check"></i><b>5.3</b> Definiciones</a><ul>
<li class="chapter" data-level="5.3.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#notacion"><i class="fa fa-check"></i><b>5.3.1</b> Notación</a></li>
<li class="chapter" data-level="5.3.2" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#razon-de-momios"><i class="fa fa-check"></i><b>5.3.2</b> Razón de momios</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#asociacion-en-tablas-de-tamano-itimes-j"><i class="fa fa-check"></i><b>5.4</b> Asociación en tablas de tamaño <span class="math inline">\(I\times J\)</span></a><ul>
<li class="chapter" data-level="5.4.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#razones-de-momios-en-tablas-itimes-j"><i class="fa fa-check"></i><b>5.4.1</b> Razones de momios en tablas <span class="math inline">\(I\times J\)</span></a></li>
<li class="chapter" data-level="5.4.2" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#ejemplo-mushrooms"><i class="fa fa-check"></i><b>5.4.2</b> Ejemplo: mushrooms</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#intervalos-de-confianza-para-los-parametros-de-asociacion"><i class="fa fa-check"></i><b>5.5</b> Intervalos de confianza para los parámetros de asociación</a><ul>
<li class="chapter" data-level="5.5.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#error-estandar-de-la-razon-de-momios"><i class="fa fa-check"></i><b>5.5.1</b> Error estándar de la razón de momios</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#prueba-de-independencia"><i class="fa fa-check"></i><b>5.6</b> Prueba de independencia</a><ul>
<li class="chapter" data-level="5.6.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#la-prueba-chi2-de-pearson"><i class="fa fa-check"></i><b>5.6.1</b> La prueba <span class="math inline">\(\chi^2\)</span> de Pearson</a></li>
<li class="chapter" data-level="5.6.2" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#ejemplo-brecha-de-genero"><i class="fa fa-check"></i><b>5.6.2</b> Ejemplo: brecha de género</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#general-social-survey-1972---2016"><i class="fa fa-check"></i><b>5.7</b> General Social Survey 1972 - 2016</a></li>
<li class="chapter" data-level="5.8" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#la-catadora-de-te"><i class="fa fa-check"></i><b>5.8</b> La catadora de té</a></li>
<li class="chapter" data-level="5.9" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#modelos-multinomiales-para-conteos"><i class="fa fa-check"></i><b>5.9</b> Modelos multinomiales para conteos</a></li>
<li class="chapter" data-level="5.10" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#modelos-log-lineales-con-tres-variables-categoricas"><i class="fa fa-check"></i><b>5.10</b> Modelos log lineales con tres variables categóricas</a><ul>
<li class="chapter" data-level="5.10.1" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#tipos-de-independencia"><i class="fa fa-check"></i><b>5.10.1</b> Tipos de independencia</a></li>
<li class="chapter" data-level="5.10.2" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#asociacion-homogenea-e-interacciones-de-3-factores"><i class="fa fa-check"></i><b>5.10.2</b> Asociación homogénea e interacciones de 3 factores</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#ejemplo-sensitividad-y-especificidad"><i class="fa fa-check"></i><b>5.11</b> Ejemplo: sensitividad y especificidad</a></li>
<li class="chapter" data-level="5.12" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#ejemplo-horoscopos"><i class="fa fa-check"></i><b>5.12</b> Ejemplo: horóscopos</a></li>
<li class="chapter" data-level="5.13" data-path="analisis-de-datos-categoricos.html"><a href="analisis-de-datos-categoricos.html#tarea-opcional"><i class="fa fa-check"></i><b>5.13</b> Tarea (opcional)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regresion-logistica-1.html"><a href="regresion-logistica-1.html"><i class="fa fa-check"></i><b>6</b> Regresión logística 1</a><ul>
<li class="chapter" data-level="6.1" data-path="regresion-logistica-1.html"><a href="regresion-logistica-1.html#regresion-logistica-con-un-solo-predictor"><i class="fa fa-check"></i><b>6.1</b> Regresión logística con un solo predictor</a></li>
<li class="chapter" data-level="6.2" data-path="regresion-logistica-1.html"><a href="regresion-logistica-1.html#el-modelo-de-regresion-logistica"><i class="fa fa-check"></i><b>6.2</b> El modelo de regresión logística</a><ul>
<li class="chapter" data-level="6.2.1" data-path="regresion-logistica-1.html"><a href="regresion-logistica-1.html#funcion-logistica"><i class="fa fa-check"></i><b>6.2.1</b> Función logística</a></li>
<li class="chapter" data-level="" data-path="regresion-logistica-1.html"><a href="regresion-logistica-1.html#ejemplo-3"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="regresion-logistica-1.html"><a href="regresion-logistica-1.html#tarea-4"><i class="fa fa-check"></i><b>6.3</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html"><i class="fa fa-check"></i><b>7</b> Regresión logística 2</a><ul>
<li class="chapter" data-level="7.1" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#incertidumbre-en-la-estimacion"><i class="fa fa-check"></i><b>7.1</b> Incertidumbre en la estimación</a></li>
<li class="chapter" data-level="7.2" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#funcion-logistica-1"><i class="fa fa-check"></i><b>7.2</b> Función logística</a></li>
<li class="chapter" data-level="7.3" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#interpretacion-de-los-coeficientes"><i class="fa fa-check"></i><b>7.3</b> Interpretación de los coeficientes</a><ul>
<li class="chapter" data-level="7.3.1" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#evaluar-en-o-alrededor-de-la-media"><i class="fa fa-check"></i><b>7.3.1</b> Evaluar en (o alrededor de) la media</a></li>
<li class="chapter" data-level="7.3.2" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#la-regla-de-dividir-entre-4"><i class="fa fa-check"></i><b>7.3.2</b> La regla de “dividir entre 4”</a></li>
<li class="chapter" data-level="7.3.3" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#interpretacion-de-los-coeficientes-como-cocientes-de-momios"><i class="fa fa-check"></i><b>7.3.3</b> Interpretación de los coeficientes como cocientes de momios</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#ejemplo-pozos-en-bangladesh"><i class="fa fa-check"></i><b>7.4</b> Ejemplo: pozos en Bangladesh</a><ul>
<li class="chapter" data-level="7.4.1" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#descripcion-del-problema"><i class="fa fa-check"></i><b>7.4.1</b> Descripción del problema</a></li>
<li class="chapter" data-level="7.4.2" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#antecedentes-del-problema"><i class="fa fa-check"></i><b>7.4.2</b> Antecedentes del problema</a></li>
<li class="chapter" data-level="7.4.3" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#metodologia-para-abordar-el-problema"><i class="fa fa-check"></i><b>7.4.3</b> Metodología para abordar el problema</a></li>
<li class="chapter" data-level="7.4.4" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#ajuste-y-resultados-del-modelo"><i class="fa fa-check"></i><b>7.4.4</b> Ajuste y resultados del modelo</a></li>
<li class="chapter" data-level="7.4.5" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#interpretacion-de-los-coeficientes-1"><i class="fa fa-check"></i><b>7.4.5</b> Interpretación de los coeficientes</a></li>
<li class="chapter" data-level="7.4.6" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#agregamos-una-segunda-variable-de-entrada"><i class="fa fa-check"></i><b>7.4.6</b> Agregamos una segunda variable de entrada</a></li>
<li class="chapter" data-level="7.4.7" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#comparacion-de-coeficientes-cuando-anades-un-predictor"><i class="fa fa-check"></i><b>7.4.7</b> Comparación de coeficientes cuando añades un predictor</a></li>
<li class="chapter" data-level="7.4.8" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#graficar-el-modelo-ajustado-con-dos-predictores"><i class="fa fa-check"></i><b>7.4.8</b> Graficar el modelo ajustado con dos predictores</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#ajuste-de-coeficientes-para-regresion-logistica-binomial."><i class="fa fa-check"></i><b>7.5</b> Ajuste de coeficientes para regresión logística (binomial).</a></li>
<li class="chapter" data-level="7.6" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#descenso-en-gradiente"><i class="fa fa-check"></i><b>7.6</b> Descenso en gradiente</a><ul>
<li class="chapter" data-level="7.6.1" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#seleccion-de-tamano-de-paso-eta"><i class="fa fa-check"></i><b>7.6.1</b> Selección de tamaño de paso <span class="math inline">\(\eta\)</span></a></li>
<li class="chapter" data-level="7.6.2" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#funciones-de-varias-variables"><i class="fa fa-check"></i><b>7.6.2</b> Funciones de varias variables</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#ejemplo-diabetes"><i class="fa fa-check"></i><b>7.7</b> Ejemplo: diabetes</a></li>
<li class="chapter" data-level="7.8" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#observaciones-adicionales"><i class="fa fa-check"></i><b>7.8</b> Observaciones adicionales</a></li>
<li class="chapter" data-level="7.9" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#regresion-logistica-para-problemas-de-mas-de-2-clases"><i class="fa fa-check"></i><b>7.9</b> Regresión logística para problemas de más de 2 clases</a></li>
<li class="chapter" data-level="7.10" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#regresion-logistica-multinomial"><i class="fa fa-check"></i><b>7.10</b> Regresión logística multinomial</a></li>
<li class="chapter" data-level="7.11" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#identificabilidad-y-separacion"><i class="fa fa-check"></i><b>7.11</b> Identificabilidad y separación</a></li>
<li class="chapter" data-level="7.12" data-path="regresion-logistica-2.html"><a href="regresion-logistica-2.html#tarea-5"><i class="fa fa-check"></i><b>7.12</b> Tarea</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Estadística Aplicada III</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulacion-y-visualizacion-de-datos" class="section level1">
<h1><span class="header-section-number">Clase 3</span> Manipulación y visualización de datos</h1>
<style>
  .espacio {
     margin-bottom: 1cm;
  }
</style>
<style>
  .espacio3 {
     margin-bottom: 3cm;
  }
</style>
<p><br></p>
<blockquote>
<p>“Happy families are all alike; every unhappy family is unhappy in its own way.” — Leo Tolstoy</p>
</blockquote>
<blockquote>
<p>“Tidy datasets are all alike; but every messy dataset is messy in its own way.” — Hadley Wickham</p>
</blockquote>
<p><br></p>
<p>Comencemos nuevamente cargando el paquete <code>tidyverse</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<p>La visualización es una herramienta importante para generar información. Sin embargo, es muy raro obtener los datos exactamente en la forma en que se necesitan. Es común tener que crear nuevas variables o hacer resúmenes a partir de algunas variables, o tal vez sólo sea necesario cambiar el nombre de las variables o reordenar las observaciones con el fin de facilitar el análisis de datos.</p>
<div id="pipeline" class="section level4 unnumbered">
<h4>Pipeline</h4>
<p>La idea de <em>pipeline</em> intenta hacer el desarrollo de código más fácil, en menor tiempo, fácil de leerlo, y por lo tanto, más fácil mantenerlo.</p>
<p>En el análisis de datos es común hacer varias operaciones y se vuelve difícil leer y entender el código. La dificultad radica en que usualmente los parámetros se asignan después del nombre de la función usando <code>()</code>.</p>
<p>La forma en que esta idea logra hacer las cosas más faciles es con el operador <strong>forwad pipe</strong> <code>%&gt;%</code>que envía un valor a una expresión o función. Este cambio en el orden funciona como el parámetro que precede a la función es enviado (“piped”) a la función. Es decir, supongamos <code>x</code> es una valor y sea <code>f</code> una función, entonces, <strong><code>x %&gt;% f</code> es igual a <code>f(x)</code>.</strong></p>
<p>Por ejemplo, sea <span class="math inline">\(f(x)\)</span> la función de probabilidad de la distribución normal con media <span class="math inline">\(\mu = 0\)</span> y desviación estándar <span class="math inline">\(\sigma = 1\)</span>: <span class="math display">\[
f(x) = \dfrac{ 1 }{\sqrt{2\pi}} e^{- \frac{1}{2} x^2 }
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  <span class="kw">exp</span>(<span class="op">-</span>(x<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">2</span><span class="op">*</span>pi)
}
<span class="co"># Con el operador de pipe</span>
<span class="dv">0</span> <span class="op">%&gt;%</span><span class="st"> </span>f
<span class="co">#&gt; [1] 0.399</span></code></pre></div>
<p>que de forma tradicional se realiza:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Forma tradicional</span>
<span class="kw">f</span>(<span class="dv">0</span>)
<span class="co">#&gt; [1] 0.399</span></code></pre></div>
<p>En resumen <code>%&gt;%</code> funciona como se muestra en la siguiente figura:</p>
<p><img src="figuras/pipe-function.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>Nota:</strong> Se puede insertar el pipe <code>%&gt;%</code> utilizando: Cmd/Ctrl + Shift + M.</p>
<p><br> <br></p>
<p><img src="figuras/manicule.jpg" /> ¿Qué hace el siguiente código? ¿Qué hace <code>.</code>?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(
  <span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">5</span>),
  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>)
)
df <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>x
df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ., <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()</code></pre></div>
<p class="espacio">
</p>
<p><br></p>
</div>
<div id="tibbles" class="section level4 unnumbered">
<h4>Tibbles</h4>
<p>Tibbles son dataframes con algunas modificaciones que permitirán trabajar mejor con los paquetes de limpieza y manipulación de datos <code>tidyr</code> y <code>dplyr</code>.</p>
<p>Una diferencia son los tipos de columnas que maneja:</p>
<ul>
<li><code>lgl:</code> vectores de valores lógicos, vectores que contienen TRUE o FALSE.</li>
<li><code>int</code>: vectores de números enteros.</li>
<li><code>dbl</code>: vectores de números reales.</li>
<li><code>chr</code>: vectores de caracteres, <em>strings</em>.</li>
</ul>
<p><br></p>
<p><img src="figuras/manicule.jpg" /> Imprime <code>ds</code> y <code>as.data.frame(ds)</code>. ¿Cuál es la diferencia entre ambas?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ds &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(mtcars)
ds
<span class="kw">as.data.frame</span>(ds)</code></pre></div>
<p class="espacio">
</p>

<div class="information">
<strong>Nota:</strong> Para mayor información de este tipo de dataframes consulta la documentación de la libreria <code>tibble</code>.
</div>

<p><br></p>
<p><br></p>
</div>
<div id="el-principio-de-datos-limpios" class="section level2">
<h2><span class="header-section-number">3.1</span> El principio de datos limpios</h2>
<p>Los principios de datos limpios (<a href="http://vita.had.co.nz/papers/tidy-data.pdf">Tidy Data de Hadley Wickham</a>) proveen una manera estándar de organizar la información:</p>
<ol style="list-style-type: decimal">
<li><p>Cada variable forma una columna.</p></li>
<li><p>Cada observación forma un renglón.</p></li>
<li><p>Cada tipo de unidad observacional forma una tabla.</p></li>
</ol>
<p><strong>Nota:</strong> La mayor parte de las bases de datos en estadística tienen forma rectangular por lo que únicamente se trataran este tipo de estructura de datos.</p>
<p>Una <strong>base de datos</strong> es una colección de valores numéricos o categóricos. Cada valor pertenece a una variable y a una observación. Una <strong>variable</strong> contiene los valores del atributo (genero, fabricante, ingreso) de la variable por unidad. Una <strong>observación</strong> contiene todos los valores medidos por la misma unidad (personas, día, autos, municipios) para diferentes atributos.</p>
<p><br></p>
<div id="ejemplo" class="section level3 unnumbered">
<h3>Ejemplo:</h3>
<p>Supongamos un experimento con 3 pacientes cada uno tiene resultados de dos tratamientos (A y B):</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>tratamientoA</th>
<th>tratamientoB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Juan Aguirre</td>
<td>-</td>
<td>2</td>
</tr>
<tr class="even">
<td>Ana Bernal</td>
<td>16</td>
<td>11</td>
</tr>
<tr class="odd">
<td>José López</td>
<td>3</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>La tabla anterior también se puede estructurar de la siguiente manera:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Juan Aguirre</th>
<th>Ana Bernal</th>
<th>José López</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>tratamientoA</td>
<td>-</td>
<td>16</td>
<td>3</td>
</tr>
<tr class="even">
<td>tratamientoB</td>
<td>2</td>
<td>11</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Si vemos los principios, entonces ¿las tablas anteriores los cumplen? Para responder la pregunta veamos:</p>
<ul>
<li><p><strong>¿Cuáles son los valores?</strong> En total se tienen 18 valores en el conjunto de datos.</p></li>
<li><p><strong>¿Cuáles son las variables?</strong> Se tienen tres variables:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>Persona/nombre: Juan Aguirre, Ana Bernal, y José López</li>
<li>Tratamiento: A y B</li>
<li>Resultado: -, 2, 16, 11, 3, 1</li>
</ol>
<ul>
<li><strong>¿Cuáles son las observaciones?</strong> Existen 6 observaciones.</li>
</ul>
<p>Entonces, siguiendo los principios de <em>datos limpios</em> obtenemos la siguiente estructura:</p>
<table>
<thead>
<tr class="header">
<th>nombre</th>
<th>tratamiento</th>
<th>resultado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Juan Aguirre</td>
<td>a</td>
<td>-</td>
</tr>
<tr class="even">
<td>Ana Bernal</td>
<td>a</td>
<td>16</td>
</tr>
<tr class="odd">
<td>José López</td>
<td>a</td>
<td>3</td>
</tr>
<tr class="even">
<td>Juan Aguirre</td>
<td>b</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Ana Bernal</td>
<td>b</td>
<td>11</td>
</tr>
<tr class="even">
<td>José López</td>
<td>b</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Una vez que identificamos los problemas de una base de datos podemos proceder a la limpieza.</p>
</div>
</div>
<div id="limpieza-de-datos" class="section level2">
<h2><span class="header-section-number">3.2</span> Limpieza de datos</h2>
<p>Algunos de los problemas más comunes en las bases de datos que no están <em>limpias</em> son:</p>
<ul>
<li><p>Los encabezados de las columnas son valores y no nombres de variables.</p></li>
<li><p>Más de una variable por columna.</p></li>
<li><p>Las variables están organizadas tanto en filas como en columnas.</p></li>
<li><p>Más de un tipo de observación en una tabla.</p></li>
<li><p>Una misma unidad observacional está almacenada en múltiples tablas.</p></li>
</ul>
<p>La mayor parte de estos problemas se pueden arreglar con pocas herramientas, a continuación veremos como <em>limpiar</em> datos usando dos funciones del paquete <em>tidyr</em> de Hadley Wickham:</p>
<ul>
<li><p><strong>gather</strong>: recibe múltiples columnas y las junta en pares de nombres y valores, convierte los datos anchos en largos.</p></li>
<li><p><strong>spread</strong>: recibe 2 columnas y las separa, haciendo los datos más anchos.</p></li>
</ul>
<p>Repasaremos los problemas más comunes que se encuentran en conjuntos de datos sucios y mostraremos cómo se puede manipular la tabla de datos (usando las funciones <em>gather</em> y <em>spread</em>) con el fin de estructurarla para que cumpla los principios de datos limpios.</p>
<p><br></p>
<hr />
<div id="los-encabezados-de-las-columnas-son-valores" class="section level4 unnumbered">
<h4>1. Los encabezados de las columnas son valores</h4>
<p>Analicemos los datos que provienen de una encuesta de <a href="http://www.pewforum.org/2009/01/30/income-distribution-within-us-religious-groups/">Pew Research</a> que investiga la relación entre ingreso y afiliación religiosa. ¿Cuáles son las variables en estos datos?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pew &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/pew.csv&quot;</span>)
knitr<span class="op">::</span><span class="kw">kable</span>(pew)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">religion</th>
<th align="right">&lt;$10k</th>
<th align="right">$10-20k</th>
<th align="right">$20-30k</th>
<th align="right">$30-40k</th>
<th align="right">$40-50k</th>
<th align="right">$50-75k</th>
<th align="right">$75-100k</th>
<th align="right">$100-150k</th>
<th align="right">&gt;150k</th>
<th align="right">Don’t know/refused</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Agnostic</td>
<td align="right">27</td>
<td align="right">34</td>
<td align="right">60</td>
<td align="right">81</td>
<td align="right">76</td>
<td align="right">137</td>
<td align="right">122</td>
<td align="right">109</td>
<td align="right">84</td>
<td align="right">96</td>
</tr>
<tr class="even">
<td align="left">Atheist</td>
<td align="right">12</td>
<td align="right">27</td>
<td align="right">37</td>
<td align="right">52</td>
<td align="right">35</td>
<td align="right">70</td>
<td align="right">73</td>
<td align="right">59</td>
<td align="right">74</td>
<td align="right">76</td>
</tr>
<tr class="odd">
<td align="left">Buddhist</td>
<td align="right">27</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="right">34</td>
<td align="right">33</td>
<td align="right">58</td>
<td align="right">62</td>
<td align="right">39</td>
<td align="right">53</td>
<td align="right">54</td>
</tr>
<tr class="even">
<td align="left">Catholic</td>
<td align="right">418</td>
<td align="right">617</td>
<td align="right">732</td>
<td align="right">670</td>
<td align="right">638</td>
<td align="right">1116</td>
<td align="right">949</td>
<td align="right">792</td>
<td align="right">633</td>
<td align="right">1489</td>
</tr>
<tr class="odd">
<td align="left">Don’t know/refused</td>
<td align="right">15</td>
<td align="right">14</td>
<td align="right">15</td>
<td align="right">11</td>
<td align="right">10</td>
<td align="right">35</td>
<td align="right">21</td>
<td align="right">17</td>
<td align="right">18</td>
<td align="right">116</td>
</tr>
<tr class="even">
<td align="left">Evangelical Prot</td>
<td align="right">575</td>
<td align="right">869</td>
<td align="right">1064</td>
<td align="right">982</td>
<td align="right">881</td>
<td align="right">1486</td>
<td align="right">949</td>
<td align="right">723</td>
<td align="right">414</td>
<td align="right">1529</td>
</tr>
<tr class="odd">
<td align="left">Hindu</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">7</td>
<td align="right">9</td>
<td align="right">11</td>
<td align="right">34</td>
<td align="right">47</td>
<td align="right">48</td>
<td align="right">54</td>
<td align="right">37</td>
</tr>
<tr class="even">
<td align="left">Historically Black Prot</td>
<td align="right">228</td>
<td align="right">244</td>
<td align="right">236</td>
<td align="right">238</td>
<td align="right">197</td>
<td align="right">223</td>
<td align="right">131</td>
<td align="right">81</td>
<td align="right">78</td>
<td align="right">339</td>
</tr>
<tr class="odd">
<td align="left">Jehovah’s Witness</td>
<td align="right">20</td>
<td align="right">27</td>
<td align="right">24</td>
<td align="right">24</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="right">15</td>
<td align="right">11</td>
<td align="right">6</td>
<td align="right">37</td>
</tr>
<tr class="even">
<td align="left">Jewish</td>
<td align="right">19</td>
<td align="right">19</td>
<td align="right">25</td>
<td align="right">25</td>
<td align="right">30</td>
<td align="right">95</td>
<td align="right">69</td>
<td align="right">87</td>
<td align="right">151</td>
<td align="right">162</td>
</tr>
<tr class="odd">
<td align="left">Mainline Prot</td>
<td align="right">289</td>
<td align="right">495</td>
<td align="right">619</td>
<td align="right">655</td>
<td align="right">651</td>
<td align="right">1107</td>
<td align="right">939</td>
<td align="right">753</td>
<td align="right">634</td>
<td align="right">1328</td>
</tr>
<tr class="even">
<td align="left">Mormon</td>
<td align="right">29</td>
<td align="right">40</td>
<td align="right">48</td>
<td align="right">51</td>
<td align="right">56</td>
<td align="right">112</td>
<td align="right">85</td>
<td align="right">49</td>
<td align="right">42</td>
<td align="right">69</td>
</tr>
<tr class="odd">
<td align="left">Muslim</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">9</td>
<td align="right">10</td>
<td align="right">9</td>
<td align="right">23</td>
<td align="right">16</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">22</td>
</tr>
<tr class="even">
<td align="left">Orthodox</td>
<td align="right">13</td>
<td align="right">17</td>
<td align="right">23</td>
<td align="right">32</td>
<td align="right">32</td>
<td align="right">47</td>
<td align="right">38</td>
<td align="right">42</td>
<td align="right">46</td>
<td align="right">73</td>
</tr>
<tr class="odd">
<td align="left">Other Christian</td>
<td align="right">9</td>
<td align="right">7</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">18</td>
<td align="right">14</td>
<td align="right">12</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">Other Faiths</td>
<td align="right">20</td>
<td align="right">33</td>
<td align="right">40</td>
<td align="right">46</td>
<td align="right">49</td>
<td align="right">63</td>
<td align="right">46</td>
<td align="right">40</td>
<td align="right">41</td>
<td align="right">71</td>
</tr>
<tr class="odd">
<td align="left">Other World Religions</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">7</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Unaffiliated</td>
<td align="right">217</td>
<td align="right">299</td>
<td align="right">374</td>
<td align="right">365</td>
<td align="right">341</td>
<td align="right">528</td>
<td align="right">407</td>
<td align="right">321</td>
<td align="right">258</td>
<td align="right">597</td>
</tr>
</tbody>
</table>
<p>Para <em>limpiarla</em> es necesario apilar las columnas, es decir, pasar los datos a <em>forma larga</em>. Esto lo realizaremos con la función <code>gather()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pew_tidy &lt;-<span class="st"> </span>pew <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(income, frequency, <span class="op">-</span>religion)
<span class="co"># vemos las primeras líneas de nuestros datos alargados</span>
pew_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">religion</th>
<th align="left">income</th>
<th align="right">frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Agnostic</td>
<td align="left">&lt;$10k</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">Atheist</td>
<td align="left">&lt;$10k</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">Buddhist</td>
<td align="left">&lt;$10k</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">Catholic</td>
<td align="left">&lt;$10k</td>
<td align="right">418</td>
</tr>
<tr class="odd">
<td align="left">Don’t know/refused</td>
<td align="left">&lt;$10k</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">Evangelical Prot</td>
<td align="left">&lt;$10k</td>
<td align="right">575</td>
</tr>
</tbody>
</table>
<p>La nueva estructura de la base de datos nos permite, por ejemplo, hacer fácilmente una gráfica donde podemos comparar las diferencias en las frecuencias.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
by_religion &lt;-<span class="st"> </span><span class="kw">group_by</span>(pew_tidy, religion)
pew_tidy_<span class="dv">2</span> &lt;-<span class="st"> </span>pew_tidy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(income <span class="op">!=</span><span class="st"> &quot;Don&#39;t know/refused&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(religion) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> frequency <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(frequency)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">sum</span>(frequency) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>)

<span class="kw">ggplot</span>(pew_tidy_<span class="dv">2</span>, <span class="kw">aes</span>(<span class="dt">x =</span> income, <span class="dt">y =</span> percent, <span class="dt">group =</span> religion)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>religion) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;darkgray&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>En el código de arriba utilizamos las funciones <code>group_by</code>, <code>filter</code> y <code>mutate</code> que estudiaremos más adelante.</p>
<p><br></p>
<hr />
<p>Otro ejemplo,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(<span class="kw">read.csv</span>(<span class="st">&quot;datos/billboard.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))
billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">artist</th>
<th align="left">track</th>
<th align="left">time</th>
<th align="left">date.entered</th>
<th align="right">wk1</th>
<th align="right">wk2</th>
<th align="right">wk3</th>
<th align="right">wk4</th>
<th align="right">wk5</th>
<th align="right">wk6</th>
<th align="right">wk7</th>
<th align="right">wk8</th>
<th align="right">wk9</th>
<th align="right">wk10</th>
<th align="right">wk11</th>
<th align="right">wk12</th>
<th align="right">wk13</th>
<th align="right">wk14</th>
<th align="right">wk15</th>
<th align="right">wk16</th>
<th align="right">wk17</th>
<th align="right">wk18</th>
<th align="right">wk19</th>
<th align="right">wk20</th>
<th align="right">wk21</th>
<th align="right">wk22</th>
<th align="right">wk23</th>
<th align="right">wk24</th>
<th align="right">wk25</th>
<th align="right">wk26</th>
<th align="right">wk27</th>
<th align="right">wk28</th>
<th align="right">wk29</th>
<th align="right">wk30</th>
<th align="right">wk31</th>
<th align="right">wk32</th>
<th align="right">wk33</th>
<th align="right">wk34</th>
<th align="right">wk35</th>
<th align="right">wk36</th>
<th align="right">wk37</th>
<th align="right">wk38</th>
<th align="right">wk39</th>
<th align="right">wk40</th>
<th align="right">wk41</th>
<th align="right">wk42</th>
<th align="right">wk43</th>
<th align="right">wk44</th>
<th align="right">wk45</th>
<th align="right">wk46</th>
<th align="right">wk47</th>
<th align="right">wk48</th>
<th align="right">wk49</th>
<th align="right">wk50</th>
<th align="right">wk51</th>
<th align="right">wk52</th>
<th align="right">wk53</th>
<th align="right">wk54</th>
<th align="right">wk55</th>
<th align="right">wk56</th>
<th align="right">wk57</th>
<th align="right">wk58</th>
<th align="right">wk59</th>
<th align="right">wk60</th>
<th align="right">wk61</th>
<th align="right">wk62</th>
<th align="right">wk63</th>
<th align="right">wk64</th>
<th align="right">wk65</th>
<th align="left">wk66</th>
<th align="left">wk67</th>
<th align="left">wk68</th>
<th align="left">wk69</th>
<th align="left">wk70</th>
<th align="left">wk71</th>
<th align="left">wk72</th>
<th align="left">wk73</th>
<th align="left">wk74</th>
<th align="left">wk75</th>
<th align="left">wk76</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Backstreet Boys, The</td>
<td align="left">The One</td>
<td align="left">3:46</td>
<td align="left">2000-05-27</td>
<td align="right">58</td>
<td align="right">50</td>
<td align="right">43</td>
<td align="right">37</td>
<td align="right">31</td>
<td align="right">30</td>
<td align="right">39</td>
<td align="right">47</td>
<td align="right">55</td>
<td align="right">61</td>
<td align="right">76</td>
<td align="right">90</td>
<td align="right">93</td>
<td align="right">93</td>
<td align="right">100</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Sisqo</td>
<td align="left">Incomplete</td>
<td align="left">3:52</td>
<td align="left">2000-06-24</td>
<td align="right">77</td>
<td align="right">66</td>
<td align="right">61</td>
<td align="right">61</td>
<td align="right">61</td>
<td align="right">55</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">9</td>
<td align="right">14</td>
<td align="right">17</td>
<td align="right">20</td>
<td align="right">25</td>
<td align="right">31</td>
<td align="right">32</td>
<td align="right">46</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Madison Avenue</td>
<td align="left">Don’t Call Me Baby</td>
<td align="left">3:44</td>
<td align="left">2000-07-08</td>
<td align="right">98</td>
<td align="right">96</td>
<td align="right">93</td>
<td align="right">93</td>
<td align="right">93</td>
<td align="right">92</td>
<td align="right">92</td>
<td align="right">92</td>
<td align="right">90</td>
<td align="right">92</td>
<td align="right">88</td>
<td align="right">88</td>
<td align="right">88</td>
<td align="right">95</td>
<td align="right">93</td>
<td align="right">98</td>
<td align="right">93</td>
<td align="right">92</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Cagle, Chris</td>
<td align="left">My Love Goes On And …</td>
<td align="left">3:02</td>
<td align="left">2000-10-21</td>
<td align="right">99</td>
<td align="right">94</td>
<td align="right">94</td>
<td align="right">87</td>
<td align="right">84</td>
<td align="right">83</td>
<td align="right">76</td>
<td align="right">76</td>
<td align="right">79</td>
<td align="right">83</td>
<td align="right">91</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">3 Doors Down</td>
<td align="left">Kryptonite</td>
<td align="left">3:53</td>
<td align="left">2000-04-08</td>
<td align="right">81</td>
<td align="right">70</td>
<td align="right">68</td>
<td align="right">67</td>
<td align="right">66</td>
<td align="right">57</td>
<td align="right">54</td>
<td align="right">53</td>
<td align="right">51</td>
<td align="right">51</td>
<td align="right">51</td>
<td align="right">51</td>
<td align="right">47</td>
<td align="right">44</td>
<td align="right">38</td>
<td align="right">28</td>
<td align="right">22</td>
<td align="right">18</td>
<td align="right">18</td>
<td align="right">14</td>
<td align="right">12</td>
<td align="right">7</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">9</td>
<td align="right">15</td>
<td align="right">14</td>
<td align="right">13</td>
<td align="right">14</td>
<td align="right">16</td>
<td align="right">17</td>
<td align="right">21</td>
<td align="right">22</td>
<td align="right">24</td>
<td align="right">28</td>
<td align="right">33</td>
<td align="right">42</td>
<td align="right">42</td>
<td align="right">49</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>Queremos apilar las semanas de manera que sea una sola columna (nuevamente alargamos los datos):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
billboard_long &lt;-<span class="st"> </span><span class="kw">gather</span>(billboard, week, rank, wk1<span class="op">:</span>wk76, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
billboard_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">artist</th>
<th align="left">track</th>
<th align="left">time</th>
<th align="left">date.entered</th>
<th align="left">week</th>
<th align="right">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Lil’ Zane</td>
<td align="left">Callin’ Me</td>
<td align="left">3:43</td>
<td align="left">2000-07-29</td>
<td align="left">wk9</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">DMX</td>
<td align="left">Party Up (Up In Here…</td>
<td align="left">3:45</td>
<td align="left">2000-02-26</td>
<td align="left">wk10</td>
<td align="right">27</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Aguilera, Christina</td>
<td align="left">Come On Over Baby (A…</td>
<td align="left">3:38</td>
<td align="left">2000-08-05</td>
<td align="left">wk6</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Thomas, Carl</td>
<td align="left">Emotional</td>
<td align="left">4:31</td>
<td align="left">2000-11-25</td>
<td align="left">wk15</td>
<td align="right">63</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Amber</td>
<td align="left">Sexual</td>
<td align="left">4:38</td>
<td align="left">1999-07-17</td>
<td align="left">wk17</td>
<td align="right">98</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Goo Goo Dolls</td>
<td align="left">Broadway</td>
<td align="left">3:54</td>
<td align="left">2000-04-22</td>
<td align="left">wk20</td>
<td align="right">87</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Westlife</td>
<td align="left">Swear It Again</td>
<td align="left">4:07</td>
<td align="left">2000-04-01</td>
<td align="left">wk3</td>
<td align="right">66</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Lonestar</td>
<td align="left">What About Now</td>
<td align="left">3:30</td>
<td align="left">2000-06-10</td>
<td align="left">wk1</td>
<td align="right">78</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Madonna</td>
<td align="left">Music</td>
<td align="left">3:45</td>
<td align="left">2000-08-12</td>
<td align="left">wk6</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">DMX</td>
<td align="left">Party Up (Up In Here…</td>
<td align="left">3:45</td>
<td align="left">2000-02-26</td>
<td align="left">wk8</td>
<td align="right">32</td>
</tr>
</tbody>
</table>
<p>La instrucción <code>na.rm = TRUE</code> se utiliza para eliminar los valores faltantes en las columnas wk1 a wk76. Realizamos una limpieza adicional creando mejores variables de fecha.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard_tidy &lt;-<span class="st"> </span>billboard_long <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">week =</span> <span class="kw">parse_number</span>(week),
    <span class="dt">date =</span> <span class="kw">as.Date</span>(date.entered) <span class="op">+</span><span class="st"> </span><span class="dv">7</span> <span class="op">*</span><span class="st"> </span>(week <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>date.entered)
billboard_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">artist</th>
<th align="left">track</th>
<th align="left">time</th>
<th align="right">week</th>
<th align="right">rank</th>
<th align="left">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Ginuwine</td>
<td align="left">The Best Man I Can B…</td>
<td align="left">4:06</td>
<td align="right">4</td>
<td align="right">94</td>
<td align="left">2000-01-29</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Dion, Celine</td>
<td align="left">That’s The Way It Is</td>
<td align="left">4:03</td>
<td align="right">8</td>
<td align="right">30</td>
<td align="left">2000-01-01</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Avant</td>
<td align="left">Separated</td>
<td align="left">4:13</td>
<td align="right">2</td>
<td align="right">32</td>
<td align="left">2000-05-06</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Vassar, Phil</td>
<td align="left">Carlene</td>
<td align="left">4:07</td>
<td align="right">7</td>
<td align="right">47</td>
<td align="left">2000-04-15</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Creed</td>
<td align="left">With Arms Wide Open</td>
<td align="left">3:52</td>
<td align="right">35</td>
<td align="right">5</td>
<td align="left">2001-01-06</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Aguilera, Christina</td>
<td align="left">Come On Over Baby (A…</td>
<td align="left">3:38</td>
<td align="right">6</td>
<td align="right">18</td>
<td align="left">2000-09-09</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Jagged Edge</td>
<td align="left">Let’s Get Married</td>
<td align="left">4:23</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="left">2000-08-05</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Walker, Clay</td>
<td align="left">The Chain Of Love</td>
<td align="left">5:03</td>
<td align="right">15</td>
<td align="right">71</td>
<td align="left">2000-07-22</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="left">Creed</td>
<td align="left">Higher</td>
<td align="left">5:16</td>
<td align="right">65</td>
<td align="right">49</td>
<td align="left">2000-12-02</td>
</tr>
<tr class="even">
<td align="right">2000</td>
<td align="left">Lonestar</td>
<td align="left">Amazed</td>
<td align="left">4:25</td>
<td align="right">37</td>
<td align="right">18</td>
<td align="left">2000-02-12</td>
</tr>
</tbody>
</table>
<p>Nuevamente, podemos hacer gráficas fácilmente.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tracks &lt;-<span class="st"> </span>billboard_tidy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(track <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Come On Over Baby (A...&quot;</span>, <span class="st">&quot;What A Girl Wants&quot;</span>, <span class="st">&quot;Say My Name&quot;</span>, <span class="st">&quot;Jumpin&#39; Jumpin&#39;&quot;</span>, <span class="st">&quot;Bye Bye Bye&quot;</span>))

<span class="kw">ggplot</span>(tracks, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> rank)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>track, <span class="dt">nrow =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-15-1.png" width="100%" style="display: block; margin: auto;" /></p>
<hr />
<p><br></p>
</div>
<div id="una-columna-asociada-a-mas-de-una-variable" class="section level4 unnumbered">
<h4>2. Una columna asociada a más de una variable</h4>
<p>La siguiente base de datos proviene de la Organización Mundial de la Salud y contiene el número de casos confirmados de tuberculosis por país y año, la información esta por grupo demográfico de acuerdo a sexo (m, f), y edad (0-4, 5-14, etc).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(countrycode)
tb &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/tb.csv&quot;</span>)
tb<span class="op">$</span>country_name &lt;-<span class="st"> </span><span class="kw">countrycode</span>(tb<span class="op">$</span>iso2, <span class="st">&#39;iso2c&#39;</span>, <span class="st">&#39;country.name&#39;</span>)
tb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">iso2</th>
<th align="right">year</th>
<th align="right">new_sp_m04</th>
<th align="right">new_sp_m514</th>
<th align="right">new_sp_m014</th>
<th align="right">new_sp_m1524</th>
<th align="right">new_sp_m2534</th>
<th align="right">new_sp_m3544</th>
<th align="right">new_sp_m4554</th>
<th align="right">new_sp_m5564</th>
<th align="right">new_sp_m65</th>
<th align="right">new_sp_mu</th>
<th align="right">new_sp_f04</th>
<th align="right">new_sp_f514</th>
<th align="right">new_sp_f014</th>
<th align="right">new_sp_f1524</th>
<th align="right">new_sp_f2534</th>
<th align="right">new_sp_f3544</th>
<th align="right">new_sp_f4554</th>
<th align="right">new_sp_f5564</th>
<th align="right">new_sp_f65</th>
<th align="right">new_sp_fu</th>
<th align="left">country_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PT</td>
<td align="right">1980</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Portugal</td>
</tr>
<tr class="even">
<td align="left">AT</td>
<td align="right">2002</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="right">14</td>
<td align="right">32</td>
<td align="right">43</td>
<td align="right">20</td>
<td align="right">25</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">13</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">21</td>
<td align="right">NA</td>
<td align="left">Austria</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="right">1984</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Luxembourg</td>
</tr>
<tr class="even">
<td align="left">OM</td>
<td align="right">1999</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">2</td>
<td align="right">10</td>
<td align="right">11</td>
<td align="right">23</td>
<td align="right">15</td>
<td align="right">7</td>
<td align="right">10</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">3</td>
<td align="right">16</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">8</td>
<td align="right">NA</td>
<td align="left">Oman</td>
</tr>
<tr class="odd">
<td align="left">NZ</td>
<td align="right">1985</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">New Zealand</td>
</tr>
</tbody>
</table>
<p>De manera similar, utilizando la función <code>gather()</code> se busca apilar las columnas correspondientes a sexo-edad.</p>
<p><strong>¿Cómo podemos separar la “variable” sexo-edad en dos columnas?</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb_long &lt;-<span class="st"> </span>tb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(demog, casos, new_sp_m04<span class="op">:</span>new_sp_fu, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
tb_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">iso2</th>
<th align="right">year</th>
<th align="left">country_name</th>
<th align="left">demog</th>
<th align="right">casos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BZ</td>
<td align="right">2001</td>
<td align="left">Belize</td>
<td align="left">new_sp_m014</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">AN</td>
<td align="right">2004</td>
<td align="left">NA</td>
<td align="left">new_sp_m3544</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">CA</td>
<td align="right">1991</td>
<td align="left">Canada</td>
<td align="left">new_sp_m4554</td>
<td align="right">37</td>
</tr>
<tr class="even">
<td align="left">NP</td>
<td align="right">2002</td>
<td align="left">Nepal</td>
<td align="left">new_sp_f1524</td>
<td align="right">1203</td>
</tr>
<tr class="odd">
<td align="left">RO</td>
<td align="right">2006</td>
<td align="left">Romania</td>
<td align="left">new_sp_m65</td>
<td align="right">580</td>
</tr>
<tr class="even">
<td align="left">BH</td>
<td align="right">1995</td>
<td align="left">Bahrain</td>
<td align="left">new_sp_m65</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">PH</td>
<td align="right">1998</td>
<td align="left">Philippines</td>
<td align="left">new_sp_f2534</td>
<td align="right">109</td>
</tr>
<tr class="even">
<td align="left">GN</td>
<td align="right">2004</td>
<td align="left">Guinea</td>
<td align="left">new_sp_f65</td>
<td align="right">63</td>
</tr>
<tr class="odd">
<td align="left">GU</td>
<td align="right">2001</td>
<td align="left">Guam</td>
<td align="left">new_sp_m2534</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">TM</td>
<td align="right">1999</td>
<td align="left">Turkmenistan</td>
<td align="left">new_sp_m2534</td>
<td align="right">225</td>
</tr>
</tbody>
</table>
<p>Las variables sexo y edad se obtienen separando la columna <strong>demog</strong>, para esto se usa la función <code>separate()</code>con los siguientes argumentos: <code>tidyr::separate(data, col = name_variabletoseparate, into = c(vector with names using &quot;&quot;), sep)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb_tidy &lt;-<span class="st"> </span>tb_long <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col =</span> demog, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">8</span>)
tb_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">iso2</th>
<th align="right">year</th>
<th align="left">country_name</th>
<th align="left">sex</th>
<th align="left">age</th>
<th align="right">casos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GN</td>
<td align="right">2004</td>
<td align="left">Guinea</td>
<td align="left">new_sp_f</td>
<td align="left">2534</td>
<td align="right">521</td>
</tr>
<tr class="even">
<td align="left">NG</td>
<td align="right">2008</td>
<td align="left">Nigeria</td>
<td align="left">new_sp_m</td>
<td align="left">u</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">PY</td>
<td align="right">2006</td>
<td align="left">Paraguay</td>
<td align="left">new_sp_f</td>
<td align="left">1524</td>
<td align="right">130</td>
</tr>
<tr class="even">
<td align="left">AT</td>
<td align="right">2007</td>
<td align="left">Austria</td>
<td align="left">new_sp_f</td>
<td align="left">2534</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">BO</td>
<td align="right">1997</td>
<td align="left">Bolivia</td>
<td align="left">new_sp_m</td>
<td align="left">1524</td>
<td align="right">1214</td>
</tr>
<tr class="even">
<td align="left">MR</td>
<td align="right">1999</td>
<td align="left">Mauritania</td>
<td align="left">new_sp_f</td>
<td align="left">3544</td>
<td align="right">110</td>
</tr>
<tr class="odd">
<td align="left">NI</td>
<td align="right">2007</td>
<td align="left">Nicaragua</td>
<td align="left">new_sp_f</td>
<td align="left">3544</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">VU</td>
<td align="right">2005</td>
<td align="left">Vanuatu</td>
<td align="left">new_sp_f</td>
<td align="left">65</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">NG</td>
<td align="right">2005</td>
<td align="left">Nigeria</td>
<td align="left">new_sp_f</td>
<td align="left">65</td>
<td align="right">415</td>
</tr>
<tr class="even">
<td align="left">JO</td>
<td align="right">2006</td>
<td align="left">Jordan</td>
<td align="left">new_sp_m</td>
<td align="left">5564</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>Ahora para hacer mejor variable <strong>sex</strong> y <strong>age</strong> usaremos la función <code>mutate()</code> que permite crear nuevas variables sin modificar la dimensión del dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
tb_tidy &lt;-<span class="st"> </span>tb_long <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col =</span> demog, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">8</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">str_sub</span>(sex, <span class="dv">8</span>, <span class="dv">8</span>),
         <span class="dt">age =</span> <span class="kw">factor</span>(age,
                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;014&quot;</span>, <span class="st">&quot;04&quot;</span>, <span class="st">&quot;1524&quot;</span>, <span class="st">&quot;2534&quot;</span>, <span class="st">&quot;3544&quot;</span>,
                                  <span class="st">&quot;4554&quot;</span>, <span class="st">&quot;514&quot;</span>,  <span class="st">&quot;5564&quot;</span>, <span class="st">&quot;65&quot;</span>,<span class="st">&quot;u&quot;</span>),
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0-14&quot;</span>, <span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;15-24&quot;</span>, <span class="st">&quot;25-34&quot;</span>, <span class="st">&quot;35-44&quot;</span>,
                                  <span class="st">&quot;45-54&quot;</span>, <span class="st">&quot;5-14&quot;</span>,  <span class="st">&quot;55-64&quot;</span>, <span class="st">&quot;65+&quot;</span>,<span class="st">&quot;unknown&quot;</span>)
                       )
          )
tb_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">iso2</th>
<th align="right">year</th>
<th align="left">country_name</th>
<th align="left">sex</th>
<th align="left">age</th>
<th align="right">casos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">LB</td>
<td align="right">2004</td>
<td align="left">Lebanon</td>
<td align="left">m</td>
<td align="left">65+</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">GT</td>
<td align="right">2007</td>
<td align="left">Guatemala</td>
<td align="left">m</td>
<td align="left">45-54</td>
<td align="right">203</td>
</tr>
<tr class="odd">
<td align="left">EG</td>
<td align="right">2007</td>
<td align="left">Egypt</td>
<td align="left">m</td>
<td align="left">25-34</td>
<td align="right">853</td>
</tr>
<tr class="even">
<td align="left">BS</td>
<td align="right">2003</td>
<td align="left">Bahamas</td>
<td align="left">f</td>
<td align="left">0-14</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">ZW</td>
<td align="right">2007</td>
<td align="left">Zimbabwe</td>
<td align="left">m</td>
<td align="left">65+</td>
<td align="right">153</td>
</tr>
<tr class="even">
<td align="left">SG</td>
<td align="right">1999</td>
<td align="left">Singapore</td>
<td align="left">f</td>
<td align="left">35-44</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">PA</td>
<td align="right">1999</td>
<td align="left">Panama</td>
<td align="left">m</td>
<td align="left">25-34</td>
<td align="right">209</td>
</tr>
<tr class="even">
<td align="left">SL</td>
<td align="right">1998</td>
<td align="left">Sierra Leone</td>
<td align="left">f</td>
<td align="left">25-34</td>
<td align="right">294</td>
</tr>
<tr class="odd">
<td align="left">MX</td>
<td align="right">2000</td>
<td align="left">Mexico</td>
<td align="left">m</td>
<td align="left">0-14</td>
<td align="right">214</td>
</tr>
<tr class="even">
<td align="left">UA</td>
<td align="right">1999</td>
<td align="left">Ukraine</td>
<td align="left">m</td>
<td align="left">45-54</td>
<td align="right">1825</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Se puede separar la columna <code>demog</code> en dos variables, sexo y edad, utilizando la función <em>separate</em>. Se debe indicar la posición de donde deseamos “cortar”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb_tidy &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">separate</span>(tb_long, demog, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dv">8</span>)
tb_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">iso2</th>
<th align="right">year</th>
<th align="left">country_name</th>
<th align="left">sex</th>
<th align="left">age</th>
<th align="right">casos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">KZ</td>
<td align="right">1998</td>
<td align="left">Kazakhstan</td>
<td align="left">new_sp_f</td>
<td align="left">4554</td>
<td align="right">204</td>
</tr>
<tr class="even">
<td align="left">PL</td>
<td align="right">2001</td>
<td align="left">Poland</td>
<td align="left">new_sp_m</td>
<td align="left">3544</td>
<td align="right">603</td>
</tr>
<tr class="odd">
<td align="left">NR</td>
<td align="right">2003</td>
<td align="left">Nauru</td>
<td align="left">new_sp_f</td>
<td align="left">014</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">NC</td>
<td align="right">1996</td>
<td align="left">New Caledonia</td>
<td align="left">new_sp_m</td>
<td align="left">4554</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">BH</td>
<td align="right">2008</td>
<td align="left">Bahrain</td>
<td align="left">new_sp_f</td>
<td align="left">1524</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">LK</td>
<td align="right">1995</td>
<td align="left">Sri Lanka</td>
<td align="left">new_sp_m</td>
<td align="left">2534</td>
<td align="right">361</td>
</tr>
<tr class="odd">
<td align="left">GH</td>
<td align="right">2000</td>
<td align="left">Ghana</td>
<td align="left">new_sp_f</td>
<td align="left">65</td>
<td align="right">176</td>
</tr>
<tr class="even">
<td align="left">ES</td>
<td align="right">2002</td>
<td align="left">Spain</td>
<td align="left">new_sp_f</td>
<td align="left">014</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">GA</td>
<td align="right">1998</td>
<td align="left">Gabon</td>
<td align="left">new_sp_f</td>
<td align="left">014</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">SE</td>
<td align="right">1999</td>
<td align="left">Sweden</td>
<td align="left">new_sp_m</td>
<td align="left">3544</td>
<td align="right">12</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><br></p>
<hr />
</div>
<div id="variables-almacenadas-en-filas-y-columnas" class="section level4 unnumbered">
<h4>3. Variables almacenadas en filas y columnas</h4>
<p>El problema más difícil es cuando las variables están tanto en filas como encolumnas, veamos una base de datos de clima en Cuernavaca. ¿Cuáles son las variables en estos datos?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clima &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(<span class="kw">read.delim</span>(<span class="st">&quot;datos/clima.txt&quot;</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>))
clima <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="left">element</th>
<th align="right">d1</th>
<th align="right">d2</th>
<th align="right">d3</th>
<th align="right">d4</th>
<th align="right">d5</th>
<th align="right">d6</th>
<th align="right">d7</th>
<th align="right">d8</th>
<th align="left">d9</th>
<th align="right">d10</th>
<th align="right">d11</th>
<th align="left">d12</th>
<th align="right">d13</th>
<th align="right">d14</th>
<th align="right">d15</th>
<th align="right">d16</th>
<th align="right">d17</th>
<th align="left">d18</th>
<th align="left">d19</th>
<th align="left">d20</th>
<th align="left">d21</th>
<th align="left">d22</th>
<th align="right">d23</th>
<th align="left">d24</th>
<th align="right">d25</th>
<th align="right">d26</th>
<th align="right">d27</th>
<th align="right">d28</th>
<th align="right">d29</th>
<th align="right">d30</th>
<th align="right">d31</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">5</td>
<td align="left">TMIN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">182</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">4</td>
<td align="left">TMIN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">167</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">1</td>
<td align="left">TMAX</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">278</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">5</td>
<td align="left">TMAX</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">332</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">12</td>
<td align="left">TMAX</td>
<td align="right">299</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">278</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">11</td>
<td align="left">TMIN</td>
<td align="right">NA</td>
<td align="right">163</td>
<td align="right">NA</td>
<td align="right">120</td>
<td align="right">79</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">121</td>
<td align="right">142</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">4</td>
<td align="left">TMAX</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">363</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">11</td>
<td align="left">TMAX</td>
<td align="right">NA</td>
<td align="right">313</td>
<td align="right">NA</td>
<td align="right">272</td>
<td align="right">263</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">281</td>
<td align="right">277</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">6</td>
<td align="left">TMIN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">175</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">180</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">3</td>
<td align="left">TMIN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">142</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">168</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">176</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>Estos datos tienen variables en columnas individuales (id, año, mes), en múltiples columnas (día, d1-d31) y en filas (tmin, tmax). Comencemos por apilar las columnas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clima_long &lt;-<span class="st"> </span>clima <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(day, value, d1<span class="op">:</span>d31, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="kw">head</span>(clima_long) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="left">element</th>
<th align="left">day</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">12</td>
<td align="left">TMAX</td>
<td align="left">d1</td>
<td align="right">299</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">12</td>
<td align="left">TMIN</td>
<td align="left">d1</td>
<td align="right">138</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="left">TMAX</td>
<td align="left">d2</td>
<td align="right">273</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="left">TMIN</td>
<td align="left">d2</td>
<td align="right">144</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">11</td>
<td align="left">TMAX</td>
<td align="left">d2</td>
<td align="right">313</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">11</td>
<td align="left">TMIN</td>
<td align="left">d2</td>
<td align="right">163</td>
</tr>
</tbody>
</table>
<p>Podemos crear algunas variables adicionales.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clima_vars &lt;-<span class="st"> </span>clima_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">day =</span> <span class="kw">extract_numeric</span>(day), <span class="dt">value =</span> value <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(id, year, month, day, element, value) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(id, year, month, day)
<span class="co">#&gt; extract_numeric() is deprecated: please use readr::parse_number() instead</span>
<span class="kw">head</span>(clima_vars) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="right">day</th>
<th align="left">element</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="left">TMAX</td>
<td align="right">27.8</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="left">TMIN</td>
<td align="right">14.5</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">TMAX</td>
<td align="right">27.3</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">TMIN</td>
<td align="right">14.4</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="left">TMAX</td>
<td align="right">24.1</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="left">TMIN</td>
<td align="right">14.4</td>
</tr>
</tbody>
</table>
<p>Finalmente, la columna <em>element</em> no es una variable, sino que almacena el nombre de dos variables, la operación que debemos aplicar (spread) es el inverso de apilar (gather):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clima_tidy &lt;-<span class="st"> </span>clima_vars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(element, value)
clima_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">id</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="right">day</th>
<th align="right">TMAX</th>
<th align="right">TMIN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">8</td>
<td align="right">23</td>
<td align="right">26.4</td>
<td align="right">15.0</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">8</td>
<td align="right">29</td>
<td align="right">28.0</td>
<td align="right">15.3</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">4</td>
<td align="right">27</td>
<td align="right">36.3</td>
<td align="right">16.7</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">11</td>
<td align="right">27</td>
<td align="right">27.7</td>
<td align="right">14.2</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">7</td>
<td align="right">14</td>
<td align="right">29.9</td>
<td align="right">16.5</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">10</td>
<td align="right">28</td>
<td align="right">31.2</td>
<td align="right">15.0</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">6</td>
<td align="right">17</td>
<td align="right">28.0</td>
<td align="right">17.5</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">32.1</td>
<td align="right">14.2</td>
</tr>
<tr class="odd">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">8</td>
<td align="right">13</td>
<td align="right">29.8</td>
<td align="right">16.5</td>
</tr>
<tr class="even">
<td align="left">MX000017004</td>
<td align="right">2010</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">27.3</td>
<td align="right">14.4</td>
</tr>
</tbody>
</table>
<p>Ahora es inmediato no solo hacer gráficas sino también ajustar un modelo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ajustamos un modelo lineal donde la variable respuesta es temperatura </span>
<span class="co"># máxima, y la variable explicativa es el mes</span>
clima_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(TMAX <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(month), <span class="dt">data =</span> clima_tidy)
<span class="kw">summary</span>(clima_lm)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = TMAX ~ factor(month), data = clima_tidy)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt;  -3.65  -0.92  -0.02   1.05   3.18 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)       27.800      1.861   14.94  5.3e-13 ***</span>
<span class="co">#&gt; factor(month)2    -0.050      2.081   -0.02   0.9810    </span>
<span class="co">#&gt; factor(month)3     4.767      2.149    2.22   0.0372 *  </span>
<span class="co">#&gt; factor(month)4     8.500      2.632    3.23   0.0039 ** </span>
<span class="co">#&gt; factor(month)5     5.400      2.632    2.05   0.0523 .  </span>
<span class="co">#&gt; factor(month)6     1.250      2.279    0.55   0.5889    </span>
<span class="co">#&gt; factor(month)7     1.450      2.279    0.64   0.5312    </span>
<span class="co">#&gt; factor(month)8     0.471      1.990    0.24   0.8149    </span>
<span class="co">#&gt; factor(month)10    1.100      2.039    0.54   0.5949    </span>
<span class="co">#&gt; factor(month)11    0.320      2.039    0.16   0.8767    </span>
<span class="co">#&gt; factor(month)12    1.050      2.279    0.46   0.6496    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.86 on 22 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.618,  Adjusted R-squared:  0.445 </span>
<span class="co">#&gt; F-statistic: 3.56 on 10 and 22 DF,  p-value: 0.0062</span></code></pre></div>
<p><br></p>
<hr />
</div>
<div id="mas-de-un-tipo-de-observacion-en-una-misma-tabla" class="section level4 unnumbered">
<h4>4. Mas de un tipo de observación en una misma tabla</h4>
<p>En ocasiones las bases de datos involucran valores en diferentes niveles, endiferentes tipos de unidad observacional. En la limpieza de datos, cada unidad observacional debe estar almacenada en su propia tabla (esto esta ligado a normalización de una base de datos), es importante para evitar inconsistencias en los datos.</p>
<p>¿Cuáles son las unidades observacionales de los datos de billboard?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(artist, track, year, time) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">20</span>)
<span class="co">#&gt; # A tibble: 20 x 7</span>
<span class="co">#&gt;    year artist track                   time   week  rank date      </span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                   &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt; 1  2000 2 Pac  Baby Don&#39;t Cry (Keep... 4:22   1.00    87 2000-02-26</span>
<span class="co">#&gt; 2  2000 2 Pac  Baby Don&#39;t Cry (Keep... 4:22   2.00    82 2000-03-04</span>
<span class="co">#&gt; 3  2000 2 Pac  Baby Don&#39;t Cry (Keep... 4:22   3.00    72 2000-03-11</span>
<span class="co">#&gt; 4  2000 2 Pac  Baby Don&#39;t Cry (Keep... 4:22   4.00    77 2000-03-18</span>
<span class="co">#&gt; 5  2000 2 Pac  Baby Don&#39;t Cry (Keep... 4:22   5.00    87 2000-03-25</span>
<span class="co">#&gt; 6  2000 2 Pac  Baby Don&#39;t Cry (Keep... 4:22   6.00    94 2000-04-01</span>
<span class="co">#&gt; # ... with 14 more rows</span></code></pre></div>
<p>Separemos esta base de datos en dos: la tabla canción que almacena artista, nombre de la canción y duración; la tabla rank que almacena el ranking de la canción en cada semana.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">song &lt;-<span class="st"> </span>billboard_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(artist, track, year, time) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(artist) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">song_id =</span> <span class="kw">row_number</span>(artist))
song <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">artist</th>
<th align="left">track</th>
<th align="right">year</th>
<th align="left">time</th>
<th align="right">song_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Zombie Nation</td>
<td align="left">Kernkraft 400</td>
<td align="right">2000</td>
<td align="left">3:30</td>
<td align="right">316</td>
</tr>
<tr class="even">
<td align="left">Brooks, Garth</td>
<td align="left">Do What You Gotta Do</td>
<td align="right">2000</td>
<td align="left">2:56</td>
<td align="right">48</td>
</tr>
<tr class="odd">
<td align="left">Larrieux, Amel</td>
<td align="left">Get Up</td>
<td align="right">2000</td>
<td align="left">4:02</td>
<td align="right">167</td>
</tr>
<tr class="even">
<td align="left">Sisqo</td>
<td align="left">Thong Song</td>
<td align="right">2000</td>
<td align="left">4:05</td>
<td align="right">265</td>
</tr>
<tr class="odd">
<td align="left">Next</td>
<td align="left">Wifey</td>
<td align="right">2000</td>
<td align="left">4:03</td>
<td align="right">224</td>
</tr>
<tr class="even">
<td align="left">Diffie, Joe</td>
<td align="left">The Quittin’ Kind</td>
<td align="right">2000</td>
<td align="left">3:23</td>
<td align="right">79</td>
</tr>
<tr class="odd">
<td align="left">Lil Wayne</td>
<td align="left">Tha Block Is Hot</td>
<td align="right">2000</td>
<td align="left">4:13</td>
<td align="right">172</td>
</tr>
<tr class="even">
<td align="left">SheDaisy</td>
<td align="left">This Woman Needs</td>
<td align="right">2000</td>
<td align="left">3:20</td>
<td align="right">258</td>
</tr>
<tr class="odd">
<td align="left">Aaliyah</td>
<td align="left">Try Again</td>
<td align="right">2000</td>
<td align="left">4:03</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Jay-Z</td>
<td align="left">Big Pimpin’</td>
<td align="right">2000</td>
<td align="left">3:55</td>
<td align="right">145</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rank &lt;-<span class="st"> </span>billboard_tidy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(song, <span class="kw">c</span>(<span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(song_id, date, week, rank) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(song_id, date) <span class="op">%&gt;%</span>
<span class="st">  </span>tbl_df
rank <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">song_id</th>
<th align="left">date</th>
<th align="right">week</th>
<th align="right">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">253</td>
<td align="left">2000-07-15</td>
<td align="right">23</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="right">255</td>
<td align="left">2000-03-11</td>
<td align="right">21</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">126</td>
<td align="left">2000-04-08</td>
<td align="right">8</td>
<td align="right">77</td>
</tr>
<tr class="even">
<td align="right">65</td>
<td align="left">2000-09-23</td>
<td align="right">1</td>
<td align="right">97</td>
</tr>
<tr class="odd">
<td align="right">131</td>
<td align="left">1999-10-30</td>
<td align="right">4</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td align="right">214</td>
<td align="left">2000-10-28</td>
<td align="right">8</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">156</td>
<td align="left">2000-09-16</td>
<td align="right">7</td>
<td align="right">36</td>
</tr>
<tr class="even">
<td align="right">211</td>
<td align="left">2000-12-02</td>
<td align="right">13</td>
<td align="right">45</td>
</tr>
<tr class="odd">
<td align="right">157</td>
<td align="left">2000-08-19</td>
<td align="right">3</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="right">264</td>
<td align="left">2000-07-01</td>
<td align="right">2</td>
<td align="right">66</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><br></p>
<hr />
</div>
<div id="una-misma-unidad-observacional-esta-almacenada-en-multiples-tablas" class="section level4 unnumbered">
<h4>5. Una misma unidad observacional está almacenada en múltiples tablas</h4>
<p>También es común que los valores sobre una misma unidad observacional estén separados en muchas tablas o archivos, es común que estas tablas esten divididas de acuerdo a una variable, de tal manera que cada archivo representa a una persona, año o ubicación. Para juntar los archivos hacemos lo siguiente:</p>
<ol style="list-style-type: decimal">
<li><p>Leemos los archivos en una lista de tablas.</p></li>
<li><p>Para cada tabla agregamos una columna que registra el nombre del archivo original.</p></li>
<li><p>Combinamos las tablas en un solo data frame.</p></li>
</ol>
<p>Veamos un ejemplo, la carpeta specdata contiene 332 archivos csv que almacenan información de monitoreo de contaminación en 332 ubicaciones de EUA. Cada archivo contiene información de una unidad de monitoreo y el número de identificación del monitor es el nombre del archivo.</p>
<p>Los pasos en R (usando el paquete plyr), primero creamos un vector con los nombres de los archivos en un directorio, aligiendo aquellos que contengan las letras “.csv”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">paths &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;datos/specdata&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.csv$&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Después le asignamos el nombre del csv al nombre de cada elemento del vector. Este paso se realiza para preservar los nmobres de los archivos ya que estos los asignaremos a una variable mas adelante.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(paths) &lt;-<span class="st"> </span><span class="kw">basename</span>(paths)</code></pre></div>
<p>La función <code>map_df</code> del paquete <code>purrr</code> itera sobre cada dirección, lee el csv en dicha dirección y los combina en un data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">specdata_US &lt;-<span class="st"> </span><span class="kw">map_df</span>(paths, read.csv, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

specdata &lt;-<span class="st"> </span>specdata_US <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">monitor =</span> <span class="kw">extract_numeric</span>(ID), <span class="dt">date =</span> <span class="kw">as.Date</span>(Date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">id =</span> ID, monitor, date, sulfate, nitrate)

<span class="kw">glimpse</span>(specdata)
<span class="co">#&gt; Observations: 772,087</span>
<span class="co">#&gt; Variables: 5</span>
<span class="co">#&gt; $ id      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...</span>
<span class="co">#&gt; $ monitor &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...</span>
<span class="co">#&gt; $ date    &lt;date&gt; 2003-01-01, 2003-01-02, 2003-01-03, 2003-01-04, 2003-...</span>
<span class="co">#&gt; $ sulfate &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...</span>
<span class="co">#&gt; $ nitrate &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...</span></code></pre></div>
<p><br></p>
<hr />
</div>
<div id="otras-consideraciones" class="section level4 unnumbered">
<h4>6. Otras consideraciones</h4>
<p>En las buenas prácticas es importante tomar en cuenta los siguientes puntos:</p>
<ul>
<li><p>Incluir un encabezado con el nombre de las variables.</p></li>
<li><p>Los nombres de las variables deben ser entendibles (e.g. age_at_diagnosis es mejor que AgeDx).</p></li>
<li><p>En general los datos se deben guardar en un archivo por tabla.</p></li>
<li><p>Escribir un script con las modificaciones que se hicieron a los <em>datos crudos</em> (reproducibilidad).</p></li>
<li><p>Otros aspectos importantes en la <em>limpieza</em> de datos son: selección del tipo de variables (por ejemplo fechas), datos faltantes, <em>typos</em> y detección de valores atípicos.</p></li>
</ul>
<p><br></p>
<hr />
</div>
</div>
<div id="separa-aplica-combina" class="section level2">
<h2><span class="header-section-number">3.3</span> <em>Separa-aplica-combina</em></h2>
<p>Muchos problemas de análisis de datos involucran la aplicación de la estrategia <strong><em>split-apply-combine</em></strong> de <a href="http://www.jstatsoft.org/v40/i01/paper">Hadley Whickam, 2011</a>. Esto se traduce en realizar filtros, cálculos y agregación de datos.</p>

<div class="nota">
<p><strong><em>Split-apply-combine</em></strong></p>
<ol style="list-style-type: decimal">
<li><p><strong>Separa</strong> la base de datos original.</p></li>
<li><p><strong>Aplica</strong> funciones a cada subconjunto.</p></li>
<li><p><strong>Combina</strong> los resultados en una nueva base de datos.</p></li>
</ol>
Consiste en romper un problema en pedazos (de acuerdo a una variable de interés), operar sobre cada subconjunto de manera independiente (calcular la media de cada grupo) y después unir los pedazos nuevamente.
</div>

<p><img src="figuras/divide-aplica-combina.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Cuando pensamos como implementar la estrategia divide-aplica-combina es natural pensar en iteraciones para recorrer cada grupo de interés y aplicar las funciones.</p>

<div class="comentario">
Para esto usaremos la librería <code>dplyr</code> que contiene funciones que facilitan la implementación de la estrategia.
</div>

<p>Son importantes las siguientes funciones de la librería <code>dplyr</code>:</p>
<ul>
<li><p><strong>filter</strong>: obtiene un subconjunto de las filas de acuerdo a una condición.</p></li>
<li><p><strong>select</strong>: selecciona columnas de acuerdo al nombre.</p></li>
<li><p><strong>arrange</strong>: re ordena las filas.</p></li>
<li><p><strong>mutate</strong>: agrega nuevas variables.</p></li>
<li><p><strong>summarise</strong>: reduce variables a valores (crear nuevas bases de datos).</p></li>
</ul>
<p>Para mostrar las funciones se usará el siguiente dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">genero =</span> <span class="kw">c</span>(<span class="st">&quot;mujer&quot;</span>, <span class="st">&quot;hombre&quot;</span>, <span class="st">&quot;mujer&quot;</span>, <span class="st">&quot;mujer&quot;</span>, <span class="st">&quot;hombre&quot;</span>), 
                    <span class="dt">estatura =</span> <span class="kw">c</span>(<span class="fl">1.65</span>, <span class="fl">1.80</span>, <span class="fl">1.70</span>, <span class="fl">1.60</span>, <span class="fl">1.67</span>))
df_ej <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">genero</th>
<th align="right">estatura</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mujer</td>
<td align="right">1.65</td>
</tr>
<tr class="even">
<td align="left">hombre</td>
<td align="right">1.80</td>
</tr>
<tr class="odd">
<td align="left">mujer</td>
<td align="right">1.70</td>
</tr>
<tr class="even">
<td align="left">mujer</td>
<td align="right">1.60</td>
</tr>
<tr class="odd">
<td align="left">hombre</td>
<td align="right">1.67</td>
</tr>
</tbody>
</table>
<div id="filtrar" class="section level4 unnumbered">
<h4>Filtrar</h4>
<p>Filtrar una base de datos dependiendo de una condición requiere la función <code>filter()</code> que tiene los siguientes argumentos <code>dplyr::filter(data, condition)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(genero <span class="op">==</span><span class="st"> &quot;mujer&quot;</span>)
<span class="co">#&gt;   genero estatura</span>
<span class="co">#&gt; 1  mujer     1.65</span>
<span class="co">#&gt; 2  mujer     1.70</span>
<span class="co">#&gt; 3  mujer     1.60</span></code></pre></div>
</div>
<div id="seleccionar" class="section level4 unnumbered">
<h4>Seleccionar</h4>
<p>Elegir columnas de un conjunto de datos se puede hacer con la función <code>select()</code> que tiene los siguientes argumentos <code>dplyr::select(data, seq_variables)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(genero)
<span class="co">#&gt;   genero</span>
<span class="co">#&gt; 1  mujer</span>
<span class="co">#&gt; 2 hombre</span>
<span class="co">#&gt; 3  mujer</span>
<span class="co">#&gt; 4  mujer</span>
<span class="co">#&gt; 5 hombre</span></code></pre></div>
<p>También, existen funciones que se usan exclusivamente en <code>select()</code>:</p>
<ul>
<li><p><code>starts_with(x, ignore.case = TRUE)</code>: los nombres empiezan con <em>x</em>.</p></li>
<li><p><code>ends_with(x, ignore.case = TRUE)</code>: los nombres terminan con <em>x</em>.</p></li>
<li><p><code>contains(x, ignore.case = TRUE)</code>: selecciona las variable que contengan <em>x</em>.</p></li>
<li><p><code>matches(x, ignore.case = TRUE)</code>: selecciona las variable que igualen la expresión regular <em>x</em>.</p></li>
<li><p><code>num_range(&quot;x&quot;, 1:5, width = 2)</code>: selecciona las variables (numéricamente) de x01 a x05.</p></li>
<li><p><code>one_of(&quot;x&quot;, &quot;y&quot;, &quot;z&quot;)</code>: selecciona las variables que estén en un vector de caracteres.</p></li>
<li><p><code>everything()</code>: selecciona todas las variables.</p></li>
</ul>
<p>Por ejemplo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;g&quot;</span>))
<span class="co">#&gt;   genero</span>
<span class="co">#&gt; 1  mujer</span>
<span class="co">#&gt; 2 hombre</span>
<span class="co">#&gt; 3  mujer</span>
<span class="co">#&gt; 4  mujer</span>
<span class="co">#&gt; 5 hombre</span></code></pre></div>
</div>
<div id="arreglar" class="section level4 unnumbered">
<h4>Arreglar</h4>
<p>Arreglar u ordenar de acuerdo al valor de una o más variables es posible con la función <code>arrange()</code> que tiene los siguientes argumentos <code>dplyr::arrange(data, variables_por_las_que_ordenar)</code>. La función <code>desc()</code> permite que se ordene de forma descendiente.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(estatura))
<span class="co">#&gt;   genero estatura</span>
<span class="co">#&gt; 1 hombre     1.80</span>
<span class="co">#&gt; 2  mujer     1.70</span>
<span class="co">#&gt; 3 hombre     1.67</span>
<span class="co">#&gt; 4  mujer     1.65</span>
<span class="co">#&gt; 5  mujer     1.60</span></code></pre></div>
</div>
<div id="mutar" class="section level4 unnumbered">
<h4>Mutar</h4>
<p>Mutar consiste en crear nuevas variables con la función <code>mutate()</code> que tiene los siguientes argumentos <code>dplyr::mutate(data, nuevas_variables = operaciones)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">estatura_cm =</span> estatura <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) 
<span class="co">#&gt;   genero estatura estatura_cm</span>
<span class="co">#&gt; 1  mujer     1.65         165</span>
<span class="co">#&gt; 2 hombre     1.80         180</span>
<span class="co">#&gt; 3  mujer     1.70         170</span>
<span class="co">#&gt; 4  mujer     1.60         160</span>
<span class="co">#&gt; 5 hombre     1.67         167</span></code></pre></div>
</div>
<div id="resumir" class="section level4 unnumbered">
<h4>Resumir</h4>
<p>Los resúmenes permiten crear nuevas bases de datos que son agregaciones de los datos originales.</p>
<p>La función <code>summarise()</code> permite realizar este resumen<code>dplyr::summarise(data, nuevas_variables = operaciones)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">promedio =</span> <span class="kw">mean</span>(estatura))
<span class="co">#&gt;   promedio</span>
<span class="co">#&gt; 1     1.68</span></code></pre></div>
<p>También es posible hacer resúmenes agrupando por variables determinadas de la base de datos. Pero, primero es necesario crear una base agrupada con la función <code>group_by()</code> con argumentos <code>dplyr::group_by(data, add = variables_por_agrupar)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(genero)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt; # Groups:   genero [2]</span>
<span class="co">#&gt;   genero estatura</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 mujer      1.65</span>
<span class="co">#&gt; 2 hombre     1.80</span>
<span class="co">#&gt; 3 mujer      1.70</span>
<span class="co">#&gt; 4 mujer      1.60</span>
<span class="co">#&gt; 5 hombre     1.67</span></code></pre></div>
<p>Después se opera sobre cada grupo, creando un resumen a nivel grupo y uniendo los subconjuntos en una base nueva:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_ej <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(genero) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">promedio =</span> <span class="kw">mean</span>(estatura))
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   genero promedio</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 hombre     1.74</span>
<span class="co">#&gt; 2 mujer      1.65</span></code></pre></div>
<p><br></p>
<hr />
</div>
</div>
<div id="muertes-por-armas-de-fuego-en-eua" class="section level2">
<h2><span class="header-section-number">3.4</span> Muertes por armas de fuego en EUA</h2>
<p>Los datos que vamos a utilizar provienen principalmente de la base de datos de causas múltiples de la muerte de los Centros para el Control y Prevención de la Enfermedad (CDCs) de Estados Unidos, de certificados de defunción de los 50 estados. Se considera que esta fuente de información es la base de datos más completa de muertes por armas de fuego.</p>
<p>Para más información puedes leer el artículo: <a href="https://fivethirtyeight.com/features/gun-deaths/" class="uri">https://fivethirtyeight.com/features/gun-deaths/</a></p>
<p>Comencemos leyendo los datos para los años 2012, 2013 y 2014:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns_<span class="dv">12</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/guns_12.csv&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)
guns_<span class="dv">13</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/guns_13.csv&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)
guns_<span class="dv">14</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/guns_14.csv&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p>Las tres tablas tienen las mismas variables en el mismo orden. Examinemos la tabla para el año 2012:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(guns_<span class="dv">12</span>)
<span class="co">#&gt; Observations: 33,096</span>
<span class="co">#&gt; Variables: 40</span>
<span class="co">#&gt; $ res_status       &lt;int&gt; 1, 3, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, ...</span>
<span class="co">#&gt; $ education_89     &lt;chr&gt; &quot;16&quot;, &quot;13&quot;, &quot;16&quot;, &quot;17&quot;, &quot;12&quot;, &quot;10&quot;, &quot;12&quot;, &quot;12...</span>
<span class="co">#&gt; $ education_03     &lt;chr&gt; &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA...</span>
<span class="co">#&gt; $ education_flag   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</span>
<span class="co">#&gt; $ month            &lt;chr&gt; &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;02&quot;, &quot;02&quot;, &quot;02&quot;, &quot;02&quot;, &quot;03...</span>
<span class="co">#&gt; $ sex              &lt;chr&gt; &quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, ...</span>
<span class="co">#&gt; $ detail_age       &lt;int&gt; 1034, 1021, 1060, 1064, 1031, 1017, 1048, 104...</span>
<span class="co">#&gt; $ age_flag         &lt;chr&gt; &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA...</span>
<span class="co">#&gt; $ age_recode       &lt;int&gt; 32, 30, 38, 38, 32, 29, 35, 34, 36, 32, 30, 3...</span>
<span class="co">#&gt; $ age_recode2      &lt;chr&gt; &quot;12&quot;, &quot;10&quot;, &quot;18&quot;, &quot;18&quot;, &quot;12&quot;, &quot;09&quot;, &quot;15&quot;, &quot;14...</span>
<span class="co">#&gt; $ age_group        &lt;chr&gt; &quot;05&quot;, &quot;04&quot;, &quot;08&quot;, &quot;08&quot;, &quot;05&quot;, &quot;04&quot;, &quot;07&quot;, &quot;06...</span>
<span class="co">#&gt; $ age_infant       &lt;chr&gt; &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA...</span>
<span class="co">#&gt; $ death_place      &lt;int&gt; 4, 7, 7, 4, 7, 4, 1, 7, 7, 4, 4, 4, 2, 4, 4, ...</span>
<span class="co">#&gt; $ marital          &lt;chr&gt; &quot;S&quot;, &quot;S&quot;, &quot;M&quot;, &quot;S&quot;, &quot;U&quot;, &quot;S&quot;, &quot;W&quot;, &quot;M&quot;, &quot;M&quot;, ...</span>
<span class="co">#&gt; $ day_of_week      &lt;int&gt; 6, 4, 7, 7, 1, 7, 5, 1, 7, 5, 1, 5, 4, 4, 5, ...</span>
<span class="co">#&gt; $ data_year        &lt;int&gt; 2012, 2012, 2012, 2012, 2012, 2012, 2012, 201...</span>
<span class="co">#&gt; $ at_work          &lt;chr&gt; &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, ...</span>
<span class="co">#&gt; $ death_manner     &lt;chr&gt; &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;5&quot;, &quot;2&quot;, &quot;1&quot;, ...</span>
<span class="co">#&gt; $ burial           &lt;chr&gt; &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, &quot;U&quot;, ...</span>
<span class="co">#&gt; $ autopsy          &lt;chr&gt; &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;Y&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, ...</span>
<span class="co">#&gt; $ activity         &lt;int&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, ...</span>
<span class="co">#&gt; $ injury_place     &lt;int&gt; 0, 4, 8, 0, 8, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, ...</span>
<span class="co">#&gt; $ underlying_cause &lt;chr&gt; &quot;X74&quot;, &quot;X74&quot;, &quot;X72&quot;, &quot;X74&quot;, &quot;X72&quot;, &quot;X73&quot;, &quot;Y2...</span>
<span class="co">#&gt; $ cause_recode358  &lt;int&gt; 429, 429, 429, 429, 429, 429, 446, 429, 407, ...</span>
<span class="co">#&gt; $ cause_recode113  &lt;int&gt; 125, 125, 125, 125, 125, 125, 132, 125, 119, ...</span>
<span class="co">#&gt; $ cause_recode130  &lt;chr&gt; &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA...</span>
<span class="co">#&gt; $ cause_recode39   &lt;int&gt; 40, 40, 40, 40, 40, 40, 42, 40, 39, 40, 40, 4...</span>
<span class="co">#&gt; $ race             &lt;chr&gt; &quot;68&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;01&quot;, &quot;03&quot;, &quot;01&quot;, &quot;03...</span>
<span class="co">#&gt; $ race_bridged     &lt;chr&gt; &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA...</span>
<span class="co">#&gt; $ race_flag        &lt;chr&gt; &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA&quot;, &quot;NA...</span>
<span class="co">#&gt; $ race_recode      &lt;int&gt; 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2, ...</span>
<span class="co">#&gt; $ race_recode2     &lt;int&gt; 4, 1, 1, 1, 1, 3, 1, 3, 1, 1, 3, 1, 3, 1, 3, ...</span>
<span class="co">#&gt; $ hispanic         &lt;int&gt; 100, 100, 100, 100, 100, 100, 100, 100, 100, ...</span>
<span class="co">#&gt; $ hispanic_recode  &lt;int&gt; 8, 6, 6, 6, 6, 8, 6, 8, 6, 6, 8, 6, 8, 6, 8, ...</span>
<span class="co">#&gt; $ intent           &lt;chr&gt; &quot;Suicide&quot;, &quot;Suicide&quot;, &quot;Suicide&quot;, &quot;Suicide&quot;, &quot;...</span>
<span class="co">#&gt; $ police           &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</span>
<span class="co">#&gt; $ weapon           &lt;chr&gt; &quot;Other/unknown&quot;, &quot;Other/unknown&quot;, &quot;Handgun&quot;, ...</span>
<span class="co">#&gt; $ year             &lt;int&gt; 2012, 2012, 2012, 2012, 2012, 2012, 2012, 201...</span>
<span class="co">#&gt; $ age              &lt;int&gt; 34, 21, 60, 64, 31, 17, 48, 41, 50, 30, 21, 4...</span>
<span class="co">#&gt; $ place            &lt;chr&gt; &quot;Home&quot;, &quot;Street&quot;, &quot;Other specified&quot;, &quot;Home&quot;, ...</span></code></pre></div>
<p>Para pegar las tablas para los 3 años vamos a utilizar la función <code>bind_rows()</code> del paquete <code>dplyr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns &lt;-<span class="st"> </span>guns_<span class="dv">12</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_rows</span>(guns_<span class="dv">13</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_rows</span>(guns_<span class="dv">14</span>)</code></pre></div>
<p>Veamos otro ejemplo de cómo recodificar variables categóricas, en este caso para la variable de nivel educativo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns &lt;-<span class="st"> </span>guns <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">education =</span> <span class="kw">ifelse</span>(education_flag <span class="op">==</span><span class="st"> </span><span class="dv">1</span>,
                            <span class="kw">cut</span>(<span class="kw">as.numeric</span>(education_<span class="dv">03</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Less than HS&quot;</span>, <span class="st">&quot;HS/GED&quot;</span>, <span class="st">&quot;Some college&quot;</span>, <span class="st">&quot;BA+&quot;</span>, <span class="ot">NA</span>))),
                            <span class="kw">cut</span>(<span class="kw">as.numeric</span>(education_<span class="dv">89</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">99</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Less than HS&quot;</span>, <span class="st">&quot;HS/GED&quot;</span>, <span class="st">&quot;Some college&quot;</span>, <span class="st">&quot;BA+&quot;</span>, <span class="ot">NA</span>))))</code></pre></div>
<p>Otro ejemplo, para la variable de raza:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns &lt;-<span class="st"> </span>guns <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race =</span> <span class="kw">as.integer</span>(race),
         <span class="dt">race =</span> <span class="kw">ifelse</span>(hispanic <span class="op">&gt;</span><span class="st"> </span><span class="dv">199</span> <span class="op">&amp;</span><span class="st"> </span>hispanic <span class="op">&lt;</span><span class="dv">996</span>, <span class="st">&quot;Hispanic&quot;</span>,
                       <span class="kw">ifelse</span>(race <span class="op">==</span><span class="st"> &quot;01&quot;</span>, <span class="st">&quot;White&quot;</span>,
                              <span class="kw">ifelse</span>(race <span class="op">==</span><span class="st"> &quot;02&quot;</span>, <span class="st">&quot;Black&quot;</span>,
                                     <span class="kw">ifelse</span>(<span class="kw">as.numeric</span>(race) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">as.numeric</span>(race) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">78</span>, <span class="st">&quot;Asian/Pacific Islander&quot;</span>,<span class="st">&quot;Native American/Native Alaskan&quot;</span>)))),
         <span class="dt">race =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(race), <span class="st">&quot;Unknown&quot;</span>, race))</code></pre></div>
<p>Para quedarnos con las variables con las que vamos a trabajar utilizamos la función <code>select()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns &lt;-<span class="st"> </span>guns <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(year, month, intent, police, sex, age, race, hispanic, place, education)</code></pre></div>
<p>Veamos de nuevo cómo es la estructura de la tabla:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(guns)
<span class="co">#&gt; Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    99396 obs. of  10 variables:</span>
<span class="co">#&gt;  $ year     : int  2012 2012 2012 2012 2012 2012 2012 2012 2012 2012 ...</span>
<span class="co">#&gt;  $ month    : chr  &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;02&quot; ...</span>
<span class="co">#&gt;  $ intent   : chr  &quot;Suicide&quot; &quot;Suicide&quot; &quot;Suicide&quot; &quot;Suicide&quot; ...</span>
<span class="co">#&gt;  $ police   : int  0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ sex      : chr  &quot;M&quot; &quot;F&quot; &quot;M&quot; &quot;M&quot; ...</span>
<span class="co">#&gt;  $ age      : int  34 21 60 64 31 17 48 41 50 30 ...</span>
<span class="co">#&gt;  $ race     : chr  &quot;Asian/Pacific Islander&quot; &quot;Native American/Native Alaskan&quot; &quot;Native American/Native Alaskan&quot; &quot;Native American/Native Alaskan&quot; ...</span>
<span class="co">#&gt;  $ hispanic : int  100 100 100 100 100 100 100 100 100 100 ...</span>
<span class="co">#&gt;  $ place    : chr  &quot;Home&quot; &quot;Street&quot; &quot;Other specified&quot; &quot;Home&quot; ...</span>
<span class="co">#&gt;  $ education: int  4 3 4 4 2 1 2 2 3 3 ...</span></code></pre></div>
<p>Supongamos que nos interesa analizar el número de suicidios por arma de fuego para cada uno de los tres años. Esto quiere decir que es necesario agrupar y usar una función de resumen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(intent <span class="op">==</span><span class="st"> &quot;Suicide&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">suicides =</span> <span class="kw">n</span>())
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;    year suicides</span>
<span class="co">#&gt;   &lt;int&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1  2012    20663</span>
<span class="co">#&gt; 2  2013    21172</span>
<span class="co">#&gt; 3  2014    21333</span></code></pre></div>
<p>Supongamos que deseamos filtar (quitar las observaciones) de homicidios para los cuales se tiene la categoría de “Other”, para ello utilizamos la función <code>filter()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">guns_sin_especificar &lt;-<span class="st"> </span>guns <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(place <span class="op">!=</span><span class="st"> &quot;Other unspecified&quot;</span> <span class="op">&amp;</span><span class="st"> </span>place <span class="op">!=</span><span class="st"> &quot;Other specified&quot;</span>)</code></pre></div>
<p>Podemos analizar la siguiente gráfica de mosaico:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(guns_sin_especificar, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">as.factor</span>(place), <span class="dt">fill=</span><span class="kw">as.factor</span>(intent))) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&#39;fill&#39;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">aspect.ratio =</span> <span class="dv">1</span>,<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>,
          <span class="dt">axis.text.y=</span><span class="kw">element_text</span>(<span class="dt">color=</span><span class="st">&#39;black&#39;</span>,<span class="dt">size=</span><span class="dv">10</span>),
          <span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">color=</span><span class="st">&#39;black&#39;</span>,<span class="dt">size=</span><span class="dv">10</span>),
          <span class="dt">axis.title.x=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),
          <span class="dt">axis.title.y=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>),
          <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_discrete</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&#39;Proporción&#39;) + xlab(&quot;Lugar&quot;) +</span>
<span class="st">    ggtitle(&quot;Lugar de homicidios por intención&quot;)</span></code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-53-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Se podría concluir, por ejemplo, que si un homicidio ocurrió en una granja, entonces lo más probable es que haya sido un suicidio.</p>
<p><br></p>
<hr />
</div>
<div id="el-cuarteto-de-anscombe" class="section level2">
<h2><span class="header-section-number">3.5</span> El Cuarteto de Anscombe</h2>
<blockquote>
<p>“The simple graph has brought more information to the data analyst’s mind than any other device.” — John Tukey</p>
</blockquote>
<p>En 1971 un estadístico llamado Frank Anscombe (fundador del departamento de Estadística de la Universidad de Yale) encontró cuatro conjuntos de datos (I, II, III y IV). Cada uno consiste de 11 observaciones y tienen las mismas propiedades estadísticas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anscombe</code></pre></div>
<center>
<table style="width:86%;">
<colgroup>
<col width="9%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="9%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">\(x_1\)</span></th>
<th><span class="math inline">\(y_1\)</span></th>
<th><span class="math inline">\(x_2\)</span></th>
<th><span class="math inline">\(y_2\)</span></th>
<th><span class="math inline">\(x_3\)</span></th>
<th><span class="math inline">\(y_3\)</span></th>
<th><span class="math inline">\(x_4\)</span></th>
<th><span class="math inline">\(y_4\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>10.0</p></td>
<td><p>8.04</p></td>
<td><p>10.0</p></td>
<td><p>9.14</p></td>
<td><p>10.0</p></td>
<td><p>7.46</p></td>
<td><p>8.0</p></td>
<td><p>6.58</p></td>
</tr>
<tr class="even">
<td><p>8.0</p></td>
<td><p>6.95</p></td>
<td><p>8.0</p></td>
<td><p>8.14</p></td>
<td><p>8.0</p></td>
<td><p>6.77</p></td>
<td><p>8.0</p></td>
<td><p>5.76</p></td>
</tr>
<tr class="odd">
<td><p>13.0</p></td>
<td><p>7.58</p></td>
<td><p>13.0</p></td>
<td><p>8.74</p></td>
<td><p>13.0</p></td>
<td><p>12.74</p></td>
<td><p>8.0</p></td>
<td><p>7.71</p></td>
</tr>
<tr class="even">
<td><p>9.0</p></td>
<td><p>8.81</p></td>
<td><p>9.0</p></td>
<td><p>8.77</p></td>
<td><p>9.0</p></td>
<td><p>7.11</p></td>
<td><p>8.0</p></td>
<td><p>8.84</p></td>
</tr>
<tr class="odd">
<td><p>11.0</p></td>
<td><p>8.33</p></td>
<td><p>11.0</p></td>
<td><p>9.26</p></td>
<td><p>11.0</p></td>
<td><p>7.81</p></td>
<td><p>8.0</p></td>
<td><p>8.47</p></td>
</tr>
<tr class="even">
<td><p>14.0</p></td>
<td><p>9.96</p></td>
<td><p>14.0</p></td>
<td><p>8.10</p></td>
<td><p>14.0</p></td>
<td><p>8.84</p></td>
<td><p>8.0</p></td>
<td><p>7.04</p></td>
</tr>
<tr class="odd">
<td><p>6.0</p></td>
<td><p>7.24</p></td>
<td><p>6.0</p></td>
<td><p>6.13</p></td>
<td><p>6.0</p></td>
<td><p>6.08</p></td>
<td><p>8.0</p></td>
<td><p>5.25</p></td>
</tr>
<tr class="even">
<td><p>4.0</p></td>
<td><p>4.26</p></td>
<td><p>4.0</p></td>
<td><p>3.10</p></td>
<td><p>4.0</p></td>
<td><p>5.39</p></td>
<td><p>19.0</p></td>
<td><p>12.50</p></td>
</tr>
<tr class="odd">
<td><p>12.0</p></td>
<td><p>10.84</p></td>
<td><p>12.0</p></td>
<td><p>9.13</p></td>
<td><p>12.0</p></td>
<td><p>8.15</p></td>
<td><p>8.0</p></td>
<td><p>5.56</p></td>
</tr>
<tr class="even">
<td><p>7.0</p></td>
<td><p>4.82</p></td>
<td><p>7.0</p></td>
<td><p>7.26</p></td>
<td><p>7.0</p></td>
<td><p>6.42</p></td>
<td><p>8.0</p></td>
<td><p>7.91</p></td>
</tr>
<tr class="odd">
<td><p>5.0</p></td>
<td><p>5.68</p></td>
<td><p>5.0</p></td>
<td><p>4.74</p></td>
<td><p>5.0</p></td>
<td><p>5.73</p></td>
<td><p>8.0</p></td>
<td><p>6.89</p></td>
</tr>
</tbody>
</table>
</center>
<p>Por ejemplo, todos los conjuntos de datos I, II, III, y IV, tienen exactamente misma media de <span class="math inline">\(x\)</span>, <span class="math inline">\(\bar{x}_i = \bar{x}_j\)</span>, y misma media de <span class="math inline">\(y\)</span>, <span class="math inline">\(\bar{y}_i = \bar{y}_j\)</span> para toda <span class="math inline">\(i,j=1,2,3,4\)</span>. Además, se puede ver que todos tienen misma varianza muestral de <span class="math inline">\(x\)</span> y de <span class="math inline">\(y\)</span>. En cada conjunto de datos la correlación entre <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span> es la misma, y por consiguiente, los coeficientes de la regresión lineal <span class="math inline">\(\beta_0\)</span> y <span class="math inline">\(\beta_1\)</span> también son iguales.</p>
<center>
<table style="width:69%;">
<colgroup>
<col width="41%" />
<col width="27%" />
</colgroup>
<thead>
<tr class="header">
<th>Propiedad</th>
<th>Valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Media de <span class="math inline">\(x\)</span></p></td>
<td><p>9</p></td>
</tr>
<tr class="even">
<td><p>Varianza muestral de <span class="math inline">\(x\)</span></p></td>
<td><p>11</p></td>
</tr>
<tr class="odd">
<td><p>Media de <span class="math inline">\(y\)</span></p></td>
<td><p>7.50</p></td>
</tr>
<tr class="even">
<td><p>Varianza muestral de <span class="math inline">\(y\)</span></p></td>
<td><p>4.12</p></td>
</tr>
<tr class="odd">
<td><p>Correlación entre <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span></p></td>
<td><p>0.816</p></td>
</tr>
<tr class="even">
<td><p>Línea de regresión lineal</p></td>
<td><p><span class="math inline">\(y = 3.00 + 0.500x\)</span></p></td>
</tr>
</tbody>
</table>
</center>
<p>¿En qué son diferentes estos conjuntos de datos? ¿Es posible con la información anterior concluir que los cuatro conjuntos de datos deben ser similares? ¿Que tengan estadísticas similares asegura que provienen de un mismo modelo?</p>
<p>Cuando analizamos los datos de manera gráfica en un histograma encontramos rápidamente que los conjuntos de datos son muy distintos.</p>
<div style="text-align: center;">
<strong>“Una imagen dice más que mil palabras.”</strong>
</div>
<p><img src="figuras/Anscombe.png" width="70%" style="display: block; margin: auto;" /></p>
<p class="espacio">
</p>
<p>En la gráfica del primer conjunto de datos, se ven datos como los que se tendrían en una relación lineal simple con un modelo que cumple los supuestos de normalidad. La segunda gráfica (la de arriba a la derecha) muestra unos datos que tienen una asociación pero definitivamente no es lineal y el coeficiente de correlación no es relevante en este caso. En la tercera gráfica (abajo a la izquierda) están puntos alineados perfectamente en una línea recta, excepto por uno de ellos. En la última gráfica podemos ver un ejemplo en el cual basta tener una observación atípica para que se produzca un coeficiente de correlación alto aún cuando en realidad no existe una asociación lineal entre las dos variables.</p>
<p>Edward Tufte usó el cuarteto en la primera página del primer capítulo de su libro The Visual Display of Quantitative Information, para enfatizar la importancia de mirar los datos antes de analizarlos. <span class="citation">(Tufte and Graves-Morris <a href="#ref-tufte2014visual">2014</a>)</span></p>
</div>
<div id="the-grammar-of-graphics-de-leland-wilkinson" class="section level2">
<h2><span class="header-section-number">3.6</span> The <em>Grammar of Graphics</em> de Leland Wilkinson</h2>
<p>Una ventaje de ggplot es que implementa una gramática de gráficas de forma organizada y con sentido orientada a esta forma de asociar variables con geometrías (Wilkinson 2005). En lugar de tener una lista enorme y conceptualmente plana de opciones para hacer gráficas, ggplot parte en varios pasos el procedimiento para realizar una gráfica:</p>
<ol style="list-style-type: decimal">
<li><p>primero, se debe proporcionar información a la función sobre qué datos y qué variables se van a utilizar.</p></li>
<li><p>segundo, se debe vincular las variables que se van a utilizar en la gráfica con las características específicas que se requiere tener en la gráfica.</p></li>
<li><p>tercero, se debe elegir una función <code>geom_</code> para indicar qué tipo de gráfica se dibujará, un diagrama de dispersión, una gráfica de barras o un diagrama de caja.</p></li>
</ol>
<p>En general, según Leland Wilkinson, hay dos principios generales que se deben seguir:</p>
<ul>
<li><p>La geometría utilizada debe coincidir con los datos que se están visualizando.</p></li>
<li><p>La geometría utilizada debe ser fácil de interpretar.</p></li>
</ul>
<p><br></p>
<hr />
</div>
<div id="ggplot" class="section level2">
<h2><span class="header-section-number">3.7</span> ggplot</h2>
<p>Vamos a ver cómo visualizar los datos usando ggplot2. R tiene varios sistemas para hacer gráficas, pero ggplot2 es uno de los más elegantes y versátiles. ggplot2 implementa la <strong>gramática de gráficas</strong>, un sistema consistente para describir y construir gráficas. Con ggplot2, pueden hacerse cosas más rápido, aprendiendo un único sistema consistente, y aplicándolo de muchas formas.</p>
<p>Para mayor información sobre los fundamentos teóricos de <code>ggplot2</code> se recomienda leer el artículo titulado “The Layered Grammar of Graphics”, visitando la siguiente liga: <a href="http://vita.had.co.nz/papers/layered-grammar.pdf" class="uri">http://vita.had.co.nz/papers/layered-grammar.pdf</a>.</p>
<p>Lo más importante para entender ggplot es comprender la estructura y la lógica para hacer una gráfica. El código debe decir cuáles son las conexiones entre las variables en los datos y los elementos de la gráfica tal como los vamos a ver en la pantalla, los puntos, los colores y las formas. En ggplot, estas conexiones lógicas entre los datos y los elementos de la gráfica se denominan <em>asignaciones estéticas</em> o simplemente <em>estéticas</em>. Se comienza una gráfica indicando a ggplot cuáles son los datos, qué variables en los datos se van a usar y luego cómo las variables en estos datos se mapean lógicamente en la estética de la gráfica. Luego, toma el resultado y se indica qué tipo de gráfica se desea, por ejemplo, un diagrama de dispersión, una gráfica de barras, o una gráfica de línea. En ggplot este tipo general de gráficas se llama <code>geom</code>. Cada <em>geom</em> tiene una función que lo crea. Por ejemplo, <code>geom_point()</code> hace diagramas de dispersión, <code>geom_bar()</code> hace gráficas de barras, <code>geom_line()</code> hace gráficas de línea, y así sucesivamente. Para combinar estas dos piezas, el objeto <code>ggplot()</code> y el <code>geom</code> se suman literalmente en una expresión, utilizando el símbolo “<code>+</code>”.</p>
<div style="text-align: center;">
<strong>¿Qué geometrías son más adecuadas para cada tipo de variable?</strong>
</div>
<p><img src="figuras/visual-variables.png" width="70%" style="display: block; margin: auto;" /></p>
<p class="espacio">
</p>
<p>Usaremos los datos de <code>gapminder</code> para hacer nuestras primeras gráficas. Vamos a asegurarnos de que la biblioteca que contiene los datos esté cargada:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gapminder)</code></pre></div>
<p>Esto hace que una tabla de datos esté disponible para su uso. Para ver un pedazo de la tabla utilizamos la función <code>glimpse()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">glimpse</span>(gapminder)
<span class="co">#&gt; Observations: 1,704</span>
<span class="co">#&gt; Variables: 6</span>
<span class="co">#&gt; $ country   &lt;fct&gt; Afghanistan, Afghanistan, Afghanistan, Afghanistan, ...</span>
<span class="co">#&gt; $ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia...</span>
<span class="co">#&gt; $ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992...</span>
<span class="co">#&gt; $ lifeExp   &lt;dbl&gt; 28.8, 30.3, 32.0, 34.0, 36.1, 38.4, 39.9, 40.8, 41.7...</span>
<span class="co">#&gt; $ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 1488...</span>
<span class="co">#&gt; $ gdpPercap &lt;dbl&gt; 779, 821, 853, 836, 740, 786, 978, 852, 649, 635, 72...</span></code></pre></div>
<p>Supongamos que queremos graficar la esperanza de vida vs el PIB per cápita para todos los años y países en los datos. Haremos esto creando un objeto que contenga parte de la información necesario y a partir de ahí vamos a construir nuestra gráfica. Primero debemos indicarle a la función <code>ggplot()</code> qué datos estamos utilizando:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder)
p</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-59-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>En este punto, ggplot sabe cuáles son nuestros datos, pero no cuál es el mapeo, es decir, qué variables de los datos deben correlacionarse con qué elementos visuales de la trama. Tampoco sabe qué tipo de trama queremos. En ggplot, las asignaciones se especifican utilizando la función <code>aes()</code>. Me gusta esta:</p>
<p>Hasta este punto ggplot conoce qué datos se van a utilizar para hacer la gráfico, pero no el <em>mapeo</em> o <em>asociación</em> de qué variables se van a relacionar con los elementos visuales de la gráfica. Tampoco se sabe qué tipo de gráfica se va a hacer. En ggplot, las asignaciones se especifican utilizando la función <code>aes()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,
            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap,
                          <span class="dt">y =</span> lifeExp))</code></pre></div>
<p>El argumento <code>mapping = aes(...)</code> <em>vincula variables a cosas que se van a ver en la gráfica</em>. Los valores de <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span> son los más obvios. Otras asignaciones estéticas pueden incluir, por ejemplo, el color, la forma, el tamaño y el tipo de línea (si una línea es sólida o discontinua, o algún otro patrón). Un mapeo no dice directamente qué formas o colores van a aparecer en la gráfica. Más bien, dicen qué <em>variables</em> en los datos serán <em>representadas</em> por los elementos visuales como color, forma o un punto.</p>
<p>¿Qué sucede si simplemente escribimos <code>p</code> en la consola y ejecutamos?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-61-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>El objeto <code>p</code> ha sido creado por la función <code>ggplot()</code>, y ya tiene información sobre las asignaciones que queremos, junto con mucha otra información añadida por defecto. (Si quiere ver cuánta información hay en el objeto <code>p</code>, intente solicitar <code>str(p)</code>). Sin embargo, no le hemos dado ninguna instrucción acerca de qué tipo de diagrama dibujar. Necesitamos agregar una capa a la trama. Esto significa elegir una función <code>geom_*</code>. Usaremos <code>geom_point()</code>. Sabe cómo tomar valores xey y trazarlos en un diagrama de dispersión.</p>
<p>Se ha creado el objeto <code>p</code> utilizando la función <code>ggplot()</code> y este objeto ya tiene información de las asignacionesque queremos. Sin embargo, no se le ha dado ninguna instrucción sobre qué tipo de gráfica se quiere dibujar. Necesitamos agregar una capa a la gráfica. Esto se hace mediante el símbolo <code>+</code>. Esto significa elegir una función <code>geom_</code>. Utilizaremos <code>geom_point()</code> para hacer un diagrama de dispersión.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-62-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>El mapeo de las propiedades estéticas se denomina <em>escalamiento</em> y depende del tipo de variable, las variables discretas (por ejemplo, genero, escolaridad, país) se mapean a distintas escalas que las variables continuas (variables numéricas como edad, estatura, etc.), los <em>defaults</em> para algunos atributos son (estos se pueden modificar):</p>
<center>
<table style="width:50%;">
<colgroup>
<col width="15%" />
<col width="20%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th>aes</th>
<th>Discreta</th>
<th>Continua</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Color (<code>color</code>)</td>
<td>Arcoiris de colores</td>
<td>Gradiente de colores</td>
</tr>
<tr class="even">
<td>Tamaño (<code>size</code>)</td>
<td>Escala discreta de tamaños</td>
<td>Mapeo lineal entre el área y el valor</td>
</tr>
<tr class="odd">
<td>Forma (<code>shape</code>)</td>
<td>Distintas formas</td>
<td>No aplica</td>
</tr>
<tr class="even">
<td>Transparencia (<code>alpha</code>)</td>
<td>No aplica</td>
<td>Mapeo lineal a la transparencia</td>
</tr>
</tbody>
</table>
</center>
<p>Los <em><em>geoms</em></em> controlan el tipo de gráfica:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>()</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-63-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Podemos ver de inmediato que algunos de estos <code>geoms</code> hacen mucho más que simplemente poner puntos en una cuadrícula. Aquí <code>geom_smooth()</code> ha calculado una línea suavizada y la región sombreada representa el error estándar de la línea suavizada. Si queremos ver los puntos de datos y la línea juntos, simplemente agregamos <code>geom_point()</code> de nuevo como una capa adicional utilizando <code>+</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,
            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap,
                          <span class="dt">y=</span>lifeExp))
p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>()</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-64-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>El mensaje de la consola de R nos dice que la función <code>geom_smooth()</code> está utilizando un método llamado gam, que en este caso significa que se ajusta a un modelo aditivo generalizado. Esto sugiere que tal vez haya otros métodos en <code>geom_smooth()</code>. Podemos intentar agregar <code>method = &quot;lm&quot;</code> (para “modelo lineal”) como un argumento para <code>geom_smooth()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,
            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap,
                          <span class="dt">y=</span>lifeExp))
p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-65-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Se puede agregar al mapeo del color de la línea el continente y del relleno de los puntos (fill) también el continente para obtener una gráfica que nos dé una idea más general de como se tiene esta relación por continente.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,
            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap,
                          <span class="dt">y =</span> lifeExp,
                          <span class="dt">color =</span> continent,
                          <span class="dt">fill =</span> continent))
p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;loess&#39;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_x_log10</span>()</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-66-1.png" width="95%" style="display: block; margin: auto;" /></p>
<p class="espacio">
</p>
</div>
<div id="un-histograma-de-las-muertes-en-iraq" class="section level2">
<h2><span class="header-section-number">3.8</span> Un histograma de las muertes en Iraq</h2>
<p>Iraq Body Count (IBC) mantiene la base de datos pública más grande sobre muertes violentas de civiles desde la invasión en Iraq del 2003. Los datos de IBC provienen de informes de medios cruzados, de hospitales, morgue, ONG y cifras o registros oficiales.</p>
<p>Para mayor información puedes visitar <a href="https://www.iraqbodycount.org/" class="uri">https://www.iraqbodycount.org/</a>.</p>
<p>Los datos los leemos con la función <code>read_csv()</code> de la librería <code>readr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ibc &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/ibc-incidents-2016-8-8.csv&quot;</span>)
ibc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="st">&quot;html&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">font_size =</span> <span class="dv">10</span>)</code></pre></div>
<table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
IBC_code
</th>
<th style="text-align:left;">
Start_Date
</th>
<th style="text-align:left;">
End_Date
</th>
<th style="text-align:left;">
Time
</th>
<th style="text-align:left;">
Location
</th>
<th style="text-align:left;">
Target
</th>
<th style="text-align:left;">
Weapons
</th>
<th style="text-align:right;">
Deaths_recorded
</th>
<th style="text-align:left;">
Sources
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
m2046
</td>
<td style="text-align:left;">
2-Sep-13
</td>
<td style="text-align:left;">
2-Sep-13
</td>
<td style="text-align:left;">
PM
</td>
<td style="text-align:left;">
13 Street, Al-Bayaa, southwest Baghdad
</td>
<td style="text-align:left;">
employee at the Ministry of Education in front of his home
</td>
<td style="text-align:left;">
gunfire
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
AIN 2 Sep, Sotaliraq 2 Sep
</td>
</tr>
<tr>
<td style="text-align:left;">
d2329
</td>
<td style="text-align:left;">
9-Feb-07
</td>
<td style="text-align:left;">
9-Feb-07
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
near Al-Shimal Garage, Mosul
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
explosive device
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
MO 09 Feb, WP 04 Apr (MoH)
</td>
</tr>
<tr>
<td style="text-align:left;">
k7919
</td>
<td style="text-align:left;">
29-Oct-07
</td>
<td style="text-align:left;">
29-Oct-07
</td>
<td style="text-align:left;">
8:00-9:00 AM
</td>
<td style="text-align:left;">
Ishbilliyah Square, central Baquba
</td>
<td style="text-align:left;">
police recruits awaiting training
</td>
<td style="text-align:left;">
suicide bomber
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
AFP 31 Oct, NINA 29 Oct, REU 29 Oct, DPA 29 Oct
</td>
</tr>
<tr>
<td style="text-align:left;">
s1254
</td>
<td style="text-align:left;">
22-Apr-15
</td>
<td style="text-align:left;">
22-Apr-15
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Al-Mansour, west Baghdad
</td>
<td style="text-align:left;">
civilian in Al-Mansour
</td>
<td style="text-align:left;">
drive-by shooting
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
NINA 22 Apr
</td>
</tr>
<tr>
<td style="text-align:left;">
h0379
</td>
<td style="text-align:left;">
25-Feb-14
</td>
<td style="text-align:left;">
25-Feb-14
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Saba’ Abkar, north Baghdad
</td>
<td style="text-align:left;">
Mohamed Taha Mohamed, Iraqi Sports Channel Director
</td>
<td style="text-align:left;">
car in hit-and-run
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
AIN 25 Feb, INN 25 Feb
</td>
</tr>
<tr>
<td style="text-align:left;">
k18626
</td>
<td style="text-align:left;">
13-Mar-12
</td>
<td style="text-align:left;">
14-Mar-12
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Hoswa, Karma, east of Falluja
</td>
<td style="text-align:left;">
civilian car
</td>
<td style="text-align:left;">
roadside bomb
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
AKnews 14 Mar, Al-Shorfa 13 Mar
</td>
</tr>
<tr>
<td style="text-align:left;">
k1708
</td>
<td style="text-align:left;">
1-Aug-05
</td>
<td style="text-align:left;">
1-Aug-05
</td>
<td style="text-align:left;">
PM
</td>
<td style="text-align:left;">
west Baghdad
</td>
<td style="text-align:left;">
Shaikh Akil al-Ma’adhidi, a cleric from al-Muhajirin mosque, brother also killed
</td>
<td style="text-align:left;">
gunfire
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Al-Jaz 02 Aug, AFP 02 Aug
</td>
</tr>
<tr>
<td style="text-align:left;">
k10200
</td>
<td style="text-align:left;">
15-Apr-08
</td>
<td style="text-align:left;">
15-Apr-08
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
al-Zahraa, east Mosul
</td>
<td style="text-align:left;">
‘operator for a private electricity generator’
</td>
<td style="text-align:left;">
gunfire
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
VOI 15 Apr
</td>
</tr>
<tr>
<td style="text-align:left;">
m3013
</td>
<td style="text-align:left;">
2-Dec-13
</td>
<td style="text-align:left;">
2-Dec-13
</td>
<td style="text-align:left;">
AM
</td>
<td style="text-align:left;">
Refaq, east Mosul
</td>
<td style="text-align:left;">
civilian in his car
</td>
<td style="text-align:left;">
magnetic bomb
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
AIN 2 Dec, NINA 2 Dec
</td>
</tr>
<tr>
<td style="text-align:left;">
k3289e
</td>
<td style="text-align:left;">
18-Jun-06
</td>
<td style="text-align:left;">
18-Jun-06
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Al-Sha’b, Baghdad
</td>
<td style="text-align:left;">
bodies found shot, tortured
</td>
<td style="text-align:left;">
gunfire, executed, tortured
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Al-Shar 18 Jun, DPA 18 Jun
</td>
</tr>
</tbody>
</table>
<p>Primero filtramos los incidentes en los que hubo al menos cinco fatalidades:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ibc_fatalidades &lt;-<span class="st"> </span>ibc <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Deaths_recorded <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span>)</code></pre></div>
<p>Una forma fácil de dibujar un histograma es utilizando la geometría <code>geom_histogram()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ibc_fatalidades, <span class="kw">aes</span>(<span class="dt">x=</span>Deaths_recorded)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>()
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-69-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="inglehartwelzel-un-mapa-cultural-del-mundo" class="section level2">
<h2><span class="header-section-number">3.9</span> Inglehart–Welzel: un mapa cultural del mundo</h2>
<p>Los teóricos de la modernización de Karl Marx a Daniel Bell han sostenido que el desarrollo económico trae cambios culturales penetrantes. Pero otros, desde Max Weber hasta Samuel Huntington, han afirmado que los valores culturales son una influencia duradera y autónoma sobre la sociedad.</p>
<p>En un artículo de la ciencia política, los autores Inglehart y Welzel de la Universidad de Michigan, afirman que el desarrollo económico está vinculado a cambios sistemáticos en los valores culturales. Utilizando los datos de la encuesta de valores mundiales WVS (World Values Survey), crearon dos índices: uno que pone énfasis en valores tradicionales y otro que pone énfasis en valores de supervivencia.</p>
<p>Características de valores tradicionales en una sociedad:</p>
<ul>
<li><p>fuerte sentimiento de orgullo nacional</p></li>
<li><p>le da más importancia a que un niño aprenda obediencia y fé religiosa en lugar de independencia y determinación</p></li>
<li><p>el aborta nunca es justificada</p></li>
<li><p>fuerte sentido de orgullo nacional</p></li>
<li><p>favorece más el respeto por la autoridad.</p></li>
</ul>
<p>Los valores seculares o racionales enfatizan lo opuesto.</p>
<p>Características de valores de supervivencia en una sociedad:</p>
<ul>
<li><p>le da prioridad a la economía sobre la calidad de vida</p></li>
<li><p>se describe como no muy feliz</p></li>
<li><p>aún no ha firmado o jamás firmaría una petición</p></li>
<li><p>la homosexualidad nuna es justificada</p></li>
<li><p>se debe ser muy cuidadoso al confiar en las personas.</p></li>
</ul>
<p>Los valores de autoexpresión enfatizan lo opuesto.</p>
<p><img src="figuras/Culture_Map_2017.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Ronald Inglehart en su artículo de 1971 <strong>The silent revolution in Europe. Intergenerational change in post-industrial societies.</strong> publicado en el <strong>American Political Science Review</strong>, propone una medida de los valores postmaterialistas de una sociedad. Esta medida se conoce como índice post-materialista de Inglehart (4-item) .</p>
<p>La siguiente pregunta de la encuesta es el punto de partida para medir el materialismo o el post-materialismo: “Si tuvieras que elegir entre las siguientes cosas, ¿cuáles son las dos que te parecen más deseables?”</p>
<ul>
<li><p>Mantener el orden en la nación.</p></li>
<li><p>Dando a la gente más voz en importantes decisiones políticas.</p></li>
<li><p>La lucha contra el aumento de los precios.</p></li>
<li><p>Proteger la libertad de expresión.</p></li>
</ul>
<p>La medida se basa entonces en la observación de que dos de las cuatro opciones, la primera y la tercera, se consideran como “preferencia hacia el valor adquisitivo en relación con la protección y adquisición de bienes”. Si se eligen las dos opciones postmaterialistas, entonces la puntuación es 3. Si se elige sólo una opción post-materialista, entonces la puntuación es 2, y de lo contrario es 1. Como todas las opciones podrían ser deseables, la medida se relaciona con la “prioridad relativa” de las elecciones materialistas sobre la segunda y cuarta y aborda las concesiones que típicamente conllevan las decisiones políticas. La conceptualización del postmaterialismo a lo largo de un continuo unidimensional está cerca del concepto de la “jerarquía de necesidades” propuesta por Maslow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
factores_inglehart &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;datos/factores_inglehart.csv&quot;</span>)
<span class="kw">glimpse</span>(factores_inglehart)
<span class="co">#&gt; Observations: 60</span>
<span class="co">#&gt; Variables: 6</span>
<span class="co">#&gt; $ country_code            &lt;int&gt; 112, 12, 152, 156, 158, 170, 196, 218,...</span>
<span class="co">#&gt; $ country                 &lt;chr&gt; &quot;Belarus&quot;, &quot;Algeria&quot;, &quot;Chile&quot;, &quot;China&quot;...</span>
<span class="co">#&gt; $ region                  &lt;chr&gt; &quot;Eastern Europe&quot;, &quot;Northern Africa&quot;, &quot;...</span>
<span class="co">#&gt; $ reg                     &lt;chr&gt; &quot;Europe &amp; Eurasia&quot;, &quot;Middle East &amp; Nor...</span>
<span class="co">#&gt; $ traditional_secular     &lt;dbl&gt; 0.91766, -0.68003, 0.14525, 1.45307, 1...</span>
<span class="co">#&gt; $ survival_selfexpression &lt;dbl&gt; -0.3187, -0.3300, 1.5769, -0.5487, 0.9...</span></code></pre></div>
<div id="creando-un-ggplot" class="section level3">
<h3><span class="header-section-number">3.9.1</span> Creando un ggplot</h3>
<p>Para graficar <code>factores_inglehart</code>, ejecuta este código para poner <code>survival_selfexpression</code> en el eje x (eje horizontal) y <code>traditional_secular</code> en el eje y (eje vertical):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular))</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-72-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="mapeos-aesthetics" class="section level3">
<h3><span class="header-section-number">3.9.2</span> Mapeos: Aesthetics</h3>
<blockquote>
<p>“The greatest value of a picture is when it forces us to notice what we never expected to see.” — John Tukey</p>
</blockquote>
<p>En la gráfica de abajo, un grupo de puntos (en rojo) parece estar fuera de la tendencia lineal. Estos países tienen menores valores de supervivencia de lo que esperaríamos de acuerdo a sus mayores valores de tradicionalismo.</p>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-73-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Podemos formular la hipótesis de que se trata de países latinoamericanos. Una forma de probar esta hipótesis es con la variable <code>reg</code>. La variable <code>reg</code> del conjunto de datos <code>factores_inglehart</code> clasifica a los países de acuerdo a su región geográfica.</p>
<p>Podemos agregar una tercera variable, como <code>reg</code>, a un diagrama de dispersión bidimensional asignándolo a un <strong>aesthetic</strong> o mapeo. Un mapeo es una propiedad visual de los objetos en la gráfica.</p>
<p>Un mapeo incluye cosas como el tamaño, la forma o el color de los puntos. Puede mostrar un punto (como el que se muestra a continuación) de diferentes maneras cambiando los valores de sus propiedades de mapeos.</p>
<p>Aquí cambiamos los niveles de tamaño, forma y color de un punto para hacer que el punto sea pequeño, triangular o azul:</p>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-74-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Podemos transmitir información sobre los datos mapeando los aesthetics en la gráfica a las variables del data frame. Por ejemplo, podemos asignar los colores de los puntos a la variable <code>reg</code> para revelar la región de cada país.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular, <span class="dt">color=</span>reg))</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-75-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Para asignar una característica a una variable, asociamos el nombre del mapeo al nombre de la variable dentro de <code>aes()</code>. <code>ggplot2</code> asignará automáticamente un nivel único de dicha característica (o mapeo) a cada valor único de la variable, un proceso conocido como <strong>escalamiento</strong>. ggplot2 también agregará una leyenda que explique qué niveles corresponden a qué valores.</p>
<p>También podríamos agregar etiquetas:</p>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-77-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div id="objetos-geometricos" class="section level4">
<h4><span class="header-section-number">3.9.2.1</span> Objetos geométricos</h4>
<p>¿En qué se parecen las siguiente dos gráficas?</p>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-78-1.png" width="70%" style="display: block; margin: auto;" /><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-78-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Ambas gráficas contienen la misma variable x, la misma variable y, y ambas describen los mismos datos. Pero las gráficas no son idénticas. Cada una utiliza un objeto visual diferente para representar los datos. En la sintaxis de ggplot2, decimos que usan diferentes <strong>geoms</strong>.</p>
<p>Un <strong>geom</strong> es un objeto geométrico que una gráfica utiliza para representar a los datos. La gente a menudo describe las gráficas por el tipo de geometría que usa la gráfica. Por ejemplo, las gráficas de barras usan geometrías de barras, los gráficos de línea utilizan geoms de línea, los boxplots usan geoms de boxplot, y así sucesivamente. Los diagramas de dispersión rompen la tendencia; Utilizan la geometría de punto.</p>
<p>La gráfica de la izquierda utiliza el punto geom, y la gráfica de la derecha utiliza el geom de smooth, una línea ajustada a los datos. Para hacer las gráficas mostradas arriba se puede utilizar el siguiente código.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#izquierda</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular))

<span class="co">#derecha</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular), <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</code></pre></div>
<p>Cada función geom en ggplot2 toma un argumento <code>mapping</code>. Sin embargo, no todas las propiedades de <strong>aesthetics</strong> funciona con cada geom. Podríamos cambiar la forma de un punto, pero no la “forma” de una línea. Por otro lado, podríamos establecer el tipo de línea de una línea. <code>geom_smooth()</code> dibujará una línea diferente, con un tipo de línea diferente, para cada valor único de la variable que se asigna al tipo de línea.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular, <span class="dt">linetype =</span> reg), <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">se =</span> F, <span class="dt">span =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-80-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Aquí <code>geom_smooth()</code> separa los países en líneas basándose en su valor de <code>reg</code> (región geográfica).</p>
<p>Podemos superponer las líneas encima de los datos sin procesar y luego coloreándolo todo de acuerdo a <code>reg</code>.</p>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-81-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Para mostrar varios geoms en la misma gráfica, agregamos varias funciones geom a <code>ggplot()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular), <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-82-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Este código genera la misma gráfica que el código anterior:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</code></pre></div>
<p>Si colocan asignaciones en una función <code>geom</code>, <code>ggplot2</code> las tratará como asignaciones locales para cada capa, de tal forma que usará estas asignaciones para extender o sobrescribir las asignaciones globales <em>para esa capa solamente</em>. Esto hace posible visualizar elementos diferentes en diferentes capas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> factores_inglehart, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> survival_selfexpression, <span class="dt">y =</span> traditional_secular)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> reg)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-84-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><br></p>
<hr />
</div>
</div>
</div>
<div id="poniendo-todo-junto" class="section level2">
<h2><span class="header-section-number">3.10</span> Poniendo todo junto</h2>
<p>El Billboard Hot 100 es un ranking semanal publicado en Estados Unidos y es utilizado en la industria de la música como una medida del rendimiento de las canciones en ventas y en streaming en el país.</p>
<p class="espacio">
</p>
<p>Por ejemplo, en la página <a href="https://www.billboard.com/charts/hot-100/2000-03-18" class="uri">https://www.billboard.com/charts/hot-100/2000-03-18</a> se puede consultar el chart en la semana del 18 de marzo del año 2000.</p>
<p><img src="figuras/billboard.png" width="70%" style="display: block; margin: auto;" /></p>
<p><br></p>
<p>Con el siguiente código podemos descargar los datos del Billboard Hot 100 para cada semana para obtener un conjunto de datos que vamos a utilizar más adelante.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>({
  <span class="kw">library</span>(tidyverse)
  <span class="kw">library</span>(rvest)
  <span class="kw">library</span>(lubridate)
})


extract_song_info &lt;-<span class="st"> </span><span class="cf">function</span>(html_row) {
  
  node_primary &lt;-<span class="st"> </span>html_row <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__primary&#39;</span>)
  
  node_secondary &lt;-<span class="st"> </span>html_row <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__secondary&#39;</span>)
  
  song_features &lt;-<span class="st"> </span><span class="kw">c</span>(
    <span class="st">&#39;.chart-row__history--rising&#39;</span>,
    <span class="st">&#39;.chart-row__bullet&#39;</span>,
    <span class="st">&#39;.chart-row__history--falling&#39;</span>,
    <span class="st">&#39;.chart-row__award-indicator&#39;</span>,
    <span class="st">&#39;.chart-row__new-indicator&#39;</span>,
    <span class="st">&#39;.chart-row__history--steady&#39;</span>)
  
  feat_search &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dt">.x =</span> song_features, <span class="dt">.f =</span> <span class="cf">function</span>(y) {
    node_primary <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(<span class="dt">css =</span> y)
  })
  
  song_node &lt;-<span class="st"> </span>node_primary <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__main-display&#39;</span>)
  
  info_node &lt;-<span class="st"> </span>song_node <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__container&#39;</span>)
  
  song_name_node &lt;-<span class="st"> </span>info_node <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__song&#39;</span>)
  
  song_artist_node &lt;-<span class="st"> </span>info_node <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__artist&#39;</span>)
  
  song_stats &lt;-<span class="st"> </span>node_secondary <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__stats&#39;</span>)
  
  last_week &lt;-<span class="st"> </span>song_stats <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__last-week .chart-row__value&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_text</span>()
  
  peak_position &lt;-<span class="st"> </span>song_stats <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__top-spot .chart-row__value&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_text</span>()
  
  wks_on_chart &lt;-<span class="st"> </span>song_stats <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__weeks-on-chart .chart-row__value&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_text</span>()
  
  current_week_rank &lt;-<span class="st"> </span>node_primary <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_node</span>(<span class="dt">css =</span> <span class="st">&#39;.chart-row__current-week&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_text</span>()
  
  artist &lt;-<span class="st"> </span>song_artist_node <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace_all</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>)
  name &lt;-<span class="st"> </span>song_name_node <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace_all</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>)
  
  song &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">current_week_rank =</span> <span class="kw">as.character</span>(current_week_rank),
                 <span class="dt">name =</span> <span class="kw">str_trim</span>(<span class="kw">as.character</span>(name)),
                 <span class="dt">artist =</span> <span class="kw">str_trim</span>(<span class="kw">as.character</span>(artist)),
                 <span class="dt">rising =</span> <span class="kw">length</span>(feat_search[[<span class="dv">1</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                 <span class="dt">steady =</span> <span class="kw">length</span>(feat_search[[<span class="dv">6</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                 <span class="dt">falling =</span> <span class="kw">length</span>(feat_search[[<span class="dv">3</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                 <span class="dt">gains_performance =</span> <span class="kw">length</span>(feat_search[[<span class="dv">2</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                 <span class="dt">award =</span> <span class="kw">length</span>(feat_search[[<span class="dv">4</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                 <span class="dt">hot_debut =</span> <span class="kw">length</span>(feat_search[[<span class="dv">5</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                 <span class="dt">last_week =</span> <span class="kw">as.character</span>(last_week),
                 <span class="dt">peak_position =</span> <span class="kw">as.character</span>(peak_position),
                 <span class="dt">wks_on_chart =</span> <span class="kw">as.character</span>(wks_on_chart)
  )
  <span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&#39;%-3s</span><span class="ch">\t</span><span class="st"> %-40s</span><span class="ch">\t</span><span class="st">%s</span><span class="ch">\n</span><span class="st">&#39;</span>, song<span class="op">$</span>current_week_rank, song<span class="op">$</span>artist, song<span class="op">$</span>name))
  
  song
}


billboard_weekchart &lt;-<span class="st"> </span><span class="cf">function</span>(fecha){
  <span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&#39;</span><span class="ch">\n\n</span><span class="st"> Fecha: </span><span class="ch">\t</span><span class="st">%s</span><span class="ch">\n\n</span><span class="st">&#39;</span>, <span class="kw">toString</span>(fecha)))
  <span class="co"># url base del Billboard Hot 100</span>
  base_url &lt;-<span class="st"> &quot;http://www.billboard.com/charts/hot-100/&quot;</span>
  current_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(base_url, fecha)
  
  webpage &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(
    {
      <span class="kw">Sys.sleep</span>(<span class="dv">5</span>)
      <span class="kw">read_html</span>(current_url);
    },
    <span class="dt">error=</span><span class="cf">function</span>(cond) {
      <span class="kw">message</span>(<span class="st">&quot;Error: Webpage did not respond succesfully.&quot;</span>)
      <span class="kw">message</span>(cond)
      <span class="kw">cat</span>(<span class="st">&#39;</span><span class="ch">\n\n</span><span class="st">&#39;</span>)
      <span class="kw">return</span>(<span class="ot">NA</span>)
    },
    <span class="dt">finally=</span>{
      <span class="kw">cat</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)
    }
  )
  
  <span class="cf">if</span>(<span class="kw">length</span>(webpage) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){
    chart &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(webpage, <span class="dt">css=</span><span class="st">&#39;.chart-data&#39;</span>)
    rows &lt;-<span class="kw">html_nodes</span>(chart, <span class="dt">css=</span><span class="st">&#39;.chart-row&#39;</span>)
    week_songs &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dt">.x =</span> rows, <span class="dt">.f =</span> extract_song_info)
    fecha_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">fecha=</span><span class="kw">rep</span>(fecha,<span class="kw">nrow</span>(week_songs)))
    week_songs &lt;-<span class="st"> </span><span class="kw">cbind</span>(fecha_df, week_songs)
  }<span class="cf">else</span>{
    <span class="kw">write</span>(<span class="kw">toString</span>(fecha), <span class="dt">file=</span><span class="st">&quot;/home/andreu/scripts/billboard/missing.txt&quot;</span>, <span class="dt">append =</span> T)
    <span class="kw">Sys.sleep</span>(<span class="dv">60</span>)
    week_songs &lt;-<span class="st"> </span><span class="ot">NULL</span>
  }
  
  <span class="cf">if</span>(<span class="kw">length</span>(week_songs) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">write_csv</span>(<span class="dt">x =</span> week_songs, <span class="dt">path =</span> <span class="kw">paste0</span>(<span class="st">&quot;/home/andreu/scripts/billboard/data/&quot;</span>,fecha,<span class="st">&quot;.csv&quot;</span>))
    val =<span class="st"> </span>T
  }<span class="cf">else</span>{
    val =<span class="st"> </span>F
  }
  
  val
}


billboard_alltime &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">start_date =</span> <span class="kw">ymd</span>(<span class="st">&#39;1958-08-04&#39;</span>), <span class="dt">current_date =</span> <span class="kw">ymd</span>(<span class="st">&#39;2018-02-03&#39;</span>)){
  <span class="kw">file.create</span>(<span class="st">&quot;/home/andreu/scripts/billboard/missing.txt&quot;</span>)
  fechas &lt;-<span class="st"> </span><span class="kw">seq</span>(start_date, current_date, <span class="dt">by =</span> <span class="st">&#39;1 week&#39;</span>)
  alltime_songs &lt;-<span class="st"> </span><span class="kw">map_lgl</span>(<span class="dt">.x =</span> fechas, <span class="dt">.f =</span> billboard_weekchart)
  
  alltime_songs
}

alltime_songs &lt;-<span class="st"> </span><span class="kw">billboard_alltime</span>(<span class="dt">start_date =</span> <span class="kw">ymd</span>(<span class="st">&#39;2018-02-03&#39;</span>))

paths &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;/home/andreu/scripts/billboard/data/&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.csv$&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)
billboard &lt;-<span class="st"> </span><span class="kw">map_df</span>(paths, read_csv, <span class="dt">col_types=</span><span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">&#39;c&#39;</span>, <span class="dv">13</span>), <span class="dt">collapse=</span><span class="st">&#39;&#39;</span>))</code></pre></div>
<p>No es necesario entender a profundidad el código utilizado para parsear el html de cada página de Billboard, sin embargo, es interesante ver el uso de las funciones <code>map</code>, <code>map_lgl</code>, y <code>map_df</code> en el fragmento de código anteior.</p>
<ol style="list-style-type: decimal">
<li><p>La función <code>map</code> se utiliza en la llamada a la primera función <code>extract_song_info</code>. Primero se definen tags del html que se necesitan parsear y posteriormente se utiliza <code>map</code> para buscar cada uno dentro del texto plano en html.</p></li>
<li><p>La función <code>map_df</code> se utiliza para aplicar cada elemento (rengón) del html en una fecha dada la función <code>extract_song_info</code> y el resultado de aplicar esta función a cada renglón del html da como resultado un data frame con los datos de la información de cada canción para cada fecha. Posteriormente, este conjunto de datos se guarda en formato csv.</p></li>
<li><p>La función <code>map_lgl</code> aplica la función <code>billboard_weekchart</code> a cada elemento de la lista de fecha y regresa un vector lógico que indica si el parseo del html tuvo éxito para cada una de las fechas.</p></li>
<li><p>La función <code>map_df</code> al final del fragmento de código lee todos los archivos correspondientes a las fechas utilizadas y como resultado junta todos los data frames en uno solo.</p></li>
</ol>
<p>Una muestra de los datos obtenidos se puede ver en la siguiente tabla:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="st">&quot;html&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">font_size =</span> <span class="dv">10</span>)</code></pre></div>
<table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
fecha
</th>
<th style="text-align:right;">
current_week_rank
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
artist
</th>
<th style="text-align:left;">
rising
</th>
<th style="text-align:left;">
steady
</th>
<th style="text-align:left;">
falling
</th>
<th style="text-align:left;">
gains_performance
</th>
<th style="text-align:left;">
award
</th>
<th style="text-align:left;">
hot_debut
</th>
<th style="text-align:left;">
last_week
</th>
<th style="text-align:right;">
peak_position
</th>
<th style="text-align:right;">
wks_on_chart
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2010-06-21
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
Undo It
</td>
<td style="text-align:left;">
Carrie Underwood
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
1996-11-18
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:left;">
Knocks Me Off My Feet
</td>
<td style="text-align:left;">
Donell Jones
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
67
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
2007-04-23
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
Go Getta
</td>
<td style="text-align:left;">
Young Jeezy Featuring R. Kelly
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
1996-07-01
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Twisted
</td>
<td style="text-align:left;">
Keith Sweat
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
1968-04-22
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
She’s Lookin’ Good
</td>
<td style="text-align:left;">
Wilson Pickett
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
45
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
1980-04-21
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
Hurt So Bad
</td>
<td style="text-align:left;">
Linda Ronstadt
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
1965-12-27
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
I Got You (I Feel Good)
</td>
<td style="text-align:left;">
James Brown And The Famous Flames
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
2006-01-16
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
Heard ’Em Say
</td>
<td style="text-align:left;">
Kanye West Featuring Adam Levine
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
40
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
1967-04-24
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
The Happening
</td>
<td style="text-align:left;">
The Supremes
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
1980-04-14
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
Steal Away
</td>
<td style="text-align:left;">
Robbie Dupree
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
85
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>Veamos de qué tipos son cada una de las columnas en los datos. Podemos usar nuevamente la función <code>glimpse</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(billboard)
<span class="co">#&gt; Observations: 310,500</span>
<span class="co">#&gt; Variables: 13</span>
<span class="co">#&gt; $ fecha             &lt;date&gt; 1958-08-04, 1958-08-04, 1958-08-04, 1958-08...</span>
<span class="co">#&gt; $ current_week_rank &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...</span>
<span class="co">#&gt; $ name              &lt;chr&gt; &quot;Poor Little Fool&quot;, &quot;Patricia&quot;, &quot;Splish Spla...</span>
<span class="co">#&gt; $ artist            &lt;chr&gt; &quot;Ricky Nelson&quot;, &quot;Perez Prado And His Orchest...</span>
<span class="co">#&gt; $ rising            &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA...</span>
<span class="co">#&gt; $ steady            &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA...</span>
<span class="co">#&gt; $ falling           &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA...</span>
<span class="co">#&gt; $ gains_performance &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA...</span>
<span class="co">#&gt; $ award             &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA...</span>
<span class="co">#&gt; $ hot_debut         &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA...</span>
<span class="co">#&gt; $ last_week         &lt;chr&gt; &quot;--&quot;, &quot;--&quot;, &quot;--&quot;, &quot;--&quot;, &quot;--&quot;, &quot;--&quot;, &quot;--&quot;, &quot;-...</span>
<span class="co">#&gt; $ peak_position     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1...</span>
<span class="co">#&gt; $ wks_on_chart      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...</span></code></pre></div>
<p>Supongamos que deseamos hacer una gráfica de barras del número de semanas en el top 10 para los 20 artistas que más semanas han permanecido en el top 10.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">artistas_top10 &lt;-<span class="st"> </span>billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(current_week_rank <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(artist) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">num_semanas_top_10 =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(num_semanas_top_<span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">20</span>, <span class="dt">wt =</span> num_semanas_top_<span class="dv">10</span>)</code></pre></div>
<p>Para hacer la gráfica con <code>ggplot</code> debemos primero ordenar los artistas de manera descendente por el número de semanas en el top 10. Para esto utilizamos la función de <code>fct_reorder</code> del paquete <code>forcats</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">artistas_top10<span class="op">$</span>artist &lt;-<span class="st"> </span>forcats<span class="op">::</span><span class="kw">fct_reorder</span>(<span class="dt">.f =</span> artistas_top10<span class="op">$</span>artist,
                                          <span class="dt">.x =</span> artistas_top10<span class="op">$</span>num_semanas_top_<span class="dv">10</span>,
                                          <span class="dt">.desc =</span> T)</code></pre></div>
<p>Por último, hacemos la gráfica indicando a <code>geom_bar</code> que la transformación estadística que debe usar es la de <em>identity</em>, es decir, la longitud de la barra corresponde al valor absoluto de la variable <code>num_semanas_top_10</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(artistas_top10, <span class="kw">aes</span>(<span class="dt">x =</span> artist, <span class="dt">y =</span> num_semanas_top_<span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="03-manipulacion_visualizacion_datos_files/figure-html/unnamed-chunk-92-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="tarea-2" class="section level2">
<h2><span class="header-section-number">3.11</span> Tarea</h2>
<p>Utiliza los datos del Billboard Hot 100 para contestar las siguientes preguntas:</p>
<ol style="list-style-type: decimal">
<li><p>¿Cuáles son los 10 artistas que han tenido más #1’s en la historia de Billboard?</p></li>
<li><p>¿Cuáles son los 10 artistas que han tenido más #1’s en los últimos 10 años? Realiza una gráfica de barras para responder a la pregunta.</p></li>
<li><p>¿Cómo se ha comportado el número promedio de semanas que una canción ha estado en el #1 a través de la historia?</p></li>
<li><p>¿Existe alguna relación entre el número de presentaciones en vivo (<code>gains_performance</code>) y el número de semanas que permance una canción en #1 desde 1980?</p></li>
<li><p>Para algunos <em>últimos</em> singles que han permanecido más semanas en el Hot 100 en algunos meses realiza una gráfica de su posición en el tiempo semana a semana. Puedes elegir alguna fecha que te interese, la fecha de tu cumpleaños o la fecha en que estuvo en #1 tu canción favorita.</p></li>
</ol>

</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references">
<div id="ref-tufte2014visual">
<p>Tufte, Edward, and P Graves-Morris. 2014. “The Visual Display of Quantitative Information.; 1983.”</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Rintro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="teorema-del-limite-central.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
